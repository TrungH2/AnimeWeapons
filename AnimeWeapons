-- Himono Hub v4.3 - DARK EDITION (MODERN UI / DUNGEON SYSTEM / CONFIG PROFILES) - ANTI-CHEAT OPTIMIZED
-- FINAL MASTER BUILD + AUTO RANK UP FEATURE (FIXED AUTO FARM & AUTO JOIN - UI REF FIX)

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local HttpService = game:GetService("HttpService")
local TweenService = game:GetService("TweenService")
local LocalPlayer = Players.LocalPlayer

-- Biáº¿n Tráº¡ng ThÃ¡i Cá»‘t LÃµi
local stealthMode = true
local safeConnections = {}
local activeLoops = {}
local selectedEnemyNames = {}
local selectedGachaType = "Biju" [cite: 10, 60]
local selectedZone = "Zone 1" [cite: 10, 60]
local selectedStat = "Mastery" [cite: 10, 60]
local autoOpenEggEnabled = false [cite: 10]
local autoStatEnabled = false [cite: 10]
local autoHatchEggEnabled = false [cite: 10]
local autoRankUpEnabled = false -- NEW: Auto Rank Up Toggle [cite: 10]

-- NEW: Biáº¿n dungeon system
local selectedDungeonMode = "Easy" [cite: 11, 61]
local autoFarmDungeonEnabled = false [cite: 11]
local autoJoinDungeonEnabled = false [cite: 11]
local autoJoinRaidEnabled = false [cite: 11]
local autoFarmRaidEnabled = falseÂ  [cite: 11]
local dungeonCompleted = false [cite: 11]
local originalPosition = nil -- Vá»‹ trÃ­ Map cÅ© cho Dungeon [cite: 11]
local raidOriginalPosition = nil -- Vá»‹ trÃ­ Map cÅ© cho Raid (tÃ¡ch biá»‡t Ä‘á»ƒ trÃ¡nh xung Ä‘á»™t) [cite: 11]

-- NEW: Biáº¿n config systemÂ 
local configProfiles = {}Â 
local selectedConfigProfile = "default" [cite: 11]
local autoLoadProfile = "" [cite: 11]

-- Biáº¿n theo dÃµi tráº¡ng thÃ¡i cÃ¡c toggle Ä‘á»ƒ lÆ°u/táº£i
local selectedFarmEnabled = false [cite: 11]
local autoAttackEnabled = false [cite: 11]
local farmRandomEnabled = false [cite: 11]
local autoCollectEnabled = false [cite: 11]
local stealthModeEnabled = true [cite: 11]
local antiAFKEnabled = true [cite: 11]

-- NEW: Biáº¿n theo dÃµi thÃ´ng bÃ¡o (Tá»ª V4.4 - DÃ¹ng cho Auto Join logic)
local dungeonNotificationActive = false [cite: 12]
local raidNotificationActive = false [cite: 12]

-- NEW: Biáº¿n cho Auto Exit Wave/Room (TÃ¡ch Toggle)
local autoExitDungeonEnabled = falseÂ  [cite: 12]
local autoExitRaidEnabled = falseÂ  Â Â  [cite: 12]
local exitDungeonWaveNumber = 0Â  [cite: 12]
local exitRaidWaveNumber = 0Â  Â Â  [cite: 12]

-- Config file paths
local configFolder = "Himonohubver2/"
local configFile = configFolder .. "GameSettings.json"
local profilesFile = configFolder .. "UserProfiles.json"

-- Táº¡o folder náº¿u chÆ°a tá»“n táº¡i
if not isfolder("Himonohubver2") then
Â  Â  makefolder("Himonohubver2")
end

-- Khá»Ÿi táº¡o random seed má»™t láº§n duy nháº¥t
local random = Random.new(tick())

-- MÃ u sáº¯c theme má»›i (Dark Modern)
local ColorTheme = {
Â  Â  Background = Color3.fromRGB(15, 15, 20), [cite: 13]
Â  Â  Secondary = Color3.fromRGB(25, 25, 35), [cite: 13]
Â  Â  Accent = Color3.fromRGB(0, 150, 255), [cite: 13]
Â  Â  AccentHover = Color3.fromRGB(0, 170, 255), [cite: 13]
Â  Â  Text = Color3.fromRGB(240, 240, 240), [cite: 13]
Â  Â  TextSecondary = Color3.fromRGB(180, 180, 200), [cite: 13]
Â  Â  Success = Color3.fromRGB(0, 200, 100), [cite: 13]
Â  Â  Danger = Color3.fromRGB(220, 60, 60), [cite: 13]
Â  Â  Warning = Color3.fromRGB(255, 180, 0) [cite: 13]
}

-- Safe remote fire
local function SafeFire(remote, ...)
Â  Â  if stealthMode then RunService.Heartbeat:Wait() end
Â  Â  remote:FireServer(...)
end

local function SafeWait()
Â  Â  if not stealthMode then task.wait(); return end [cite: 14]
Â  Â  local delay = random:NextNumber(20, 50) / 100
Â  Â  local start = tick()
Â  Â  while tick() - start < delay do RunService.Heartbeat:Wait() end
end

local function SafeCall(func, ...)
Â  Â  local success, result = pcall(func, ...)
Â  Â  return success and result or nil
end

local function SafeConnect(signal, callback)
Â  Â  local conn = signal:Connect(function(...)
Â  Â  Â  Â  if stealthMode then SafeWait() end
Â  Â  Â  Â  SafeCall(callback, ...)
Â  Â  end)
Â  Â  table.insert(safeConnections, conn)
Â  Â  return conn
end

local function StartLoop(name, func, interval)
Â  Â  if activeLoops[name] then activeLoops[name] = false; task.wait(0.1) end [cite: 15]
Â  Â  activeLoops[name] = true
Â  Â  task.spawn(function()
Â  Â  Â  Â  while activeLoops[name] do
Â  Â  Â  Â  Â  Â  pcall(func)
Â  Â  Â  Â  Â  Â  if interval then task.wait(interval) else RunService.Heartbeat:Wait() end
Â  Â  Â  Â  end
Â  Â  end)
end

local function StopLoop(name)
Â  Â  if activeLoops[name] then activeLoops[name] = false end [cite: 15]
end

-- NEW FUNCTION: Äá»c Wave/Room tá»« UI (DÃ² tÃ¬m TextLabel)
local function ReadWaveFromUI()
Â  Â  local playerGui = LocalPlayer:FindFirstChild("PlayerGui")
Â  Â  local containerServices = {game:GetService("CoreGui"), playerGui}
Â  Â Â 
Â  Â  for _, service in ipairs(containerServices) do
Â  Â  Â  Â  if not service then continue end
Â  Â  Â  Â Â 
Â  Â  Â  Â  for _, obj in pairs(service:GetDescendants()) do
Â  Â  Â  Â  Â  Â  if obj:IsA("TextLabel") or obj:IsA("TextBox") then [cite: 16]
Â  Â  Â  Â  Â  Â  Â  Â  local text = obj.Text or ""
Â  Â  Â  Â  Â  Â  Â  Â  local number = string.match(text, "Wave%s*:?%s*(%d+)") [cite: 16]
Â  Â  Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  if not number then
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  number = string.match(text, "^%s*(%d+)%s*$")Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if number and tonumber(number) > 1 and tonumber(number) < 500 thenÂ  [cite: 16]
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if obj.Name:find("Wave") or obj.Name:find("Room") or obj.Name:find("Number") or obj.Name:find("Counter") then [cite: 17]
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return tonumber(number) [cite: 17]
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  end
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  end
Â  Â  Â  Â  Â  Â  Â  Â  else
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return tonumber(number) [cite: 17]
Â  Â  Â  Â  Â  Â  Â  Â  end
Â  Â  Â  Â  Â  Â  end
Â  Â  Â  Â  end
Â  Â  end
Â  Â  return 1Â 
end

-- NEW: HÃ m kiá»ƒm tra thÃ´ng bÃ¡o trÃªn mÃ n hÃ¬nh (ÄÃ£ Ä‘Æ¡n giáº£n hÃ³a vÃ¬ chuyá»ƒn sang Remote Join) [cite: 18]
local function CheckScreenNotifications()
Â  Â  dungeonNotificationActive = false [cite: 18]
Â  Â  raidNotificationActive = false [cite: 18]
    -- Váº«n giá»¯ logic quÃ©t Ä‘á»ƒ lÃ m cÆ¡ sá»Ÿ cho Auto Join.

Â  Â  local gui = game:GetService("CoreGui") [cite: 19]
Â  Â  local playerGui = LocalPlayer:FindFirstChild("PlayerGui") [cite: 19]
Â  Â  local containerServices = {gui, playerGui} [cite: 19]

Â  Â  for _, service in ipairs(containerServices) do
Â  Â  Â  Â  if not service then continue end
Â  Â  Â  Â  for _, child in pairs(service:GetDescendants()) do
Â  Â  Â  Â  Â  Â  if child:IsA("TextLabel") or child:IsA("TextButton") or child:IsA("Frame") then [cite: 19]
Â  Â  Â  Â  Â  Â  Â  Â  local text = string.lower(tostring(child.Text or child.Name)) [cite: 19]
Â  Â  Â  Â  Â  Â  Â  Â  -- TÃ¬m Dungeon Notification
Â  Â  Â  Â  Â  Â  Â  Â  if text:find("dungeon") and (text:find("open") or text:find("available") or text:find(selectedDungeonMode:lower())) then [cite: 20]
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dungeonNotificationActive = true [cite: 20]
Â  Â  Â  Â  Â  Â  Â  Â  end
Â  Â  Â  Â  Â  Â  Â  Â  -- TÃ¬m Raid Notification
Â  Â  Â  Â  Â  Â  Â  Â  if text:find("raid") and (text:find("open") or text:find("available") or text:find("boss")) then [cite: 20]
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  raidNotificationActive = true [cite: 20]
Â  Â  Â  Â  Â  Â  Â  Â  end
Â  Â  Â  Â  Â  Â  end
Â  Â  Â  Â  end
Â  Â  end
end

-- NEW: Auto Join Dungeon Logic (Remote Join sau má»—i 5s náº¿u toggle Báº¬T)
local function AutoJoinDungeonLoop()
Â  Â  if autoJoinDungeonEnabled then [cite: 21]
Â  Â  Â  Â  pcall(function()
            -- THá»°C HIá»†N JOIN DÃ™ KHÃ”NG CÃ“ NOTIFICATION (Hard Join)
Â  Â  Â  Â  Â  Â  mainStatus.Text = "ðŸŒ Auto Join Dungeon: Äang cá»‘ gáº¯ng tham gia Dungeon ("..selectedDungeonMode..")..." [cite: 21]
Â  Â  Â  Â  Â  Â  JoinDungeon(selectedDungeonMode) [cite: 21]
Â  Â  Â  Â  end)
Â  Â  end
end

-- NEW: Auto Join Raid Logic (Remote Join sau má»—i 5s náº¿u toggle Báº¬T)
local function AutoJoinRaidLoop()
Â  Â  if autoJoinRaidEnabled then [cite: 22]
Â  Â  Â  Â  pcall(function()
            -- THá»°C HIá»†N JOIN DÃ™ KHÃ”NG CÃ“ NOTIFICATION (Hard Join)
Â  Â  Â  Â  Â  Â  mainStatus.Text = "ðŸŒ Auto Join Raid: Äang cá»‘ gáº¯ng tham gia Raid..." [cite: 22]
Â  Â  Â  Â  Â  Â  JoinRaid() [cite: 22]
Â  Â  Â  Â  end)
Â  Â  end
end

local antiAFKConnection
local function EnableAntiAFK()
Â  Â  if antiAFKConnection then antiAFKConnection:Disconnect() end
Â  Â  antiAFKConnection = LocalPlayer.Idled:Connect(function()
Â  Â  Â  Â  SafeCall(function()
Â  Â  Â  Â  Â  Â  VirtualUser:CaptureController()
Â  Â  Â  Â  Â  Â  VirtualUser:ClickButton2(Vector2.new())
Â  Â  Â  Â  end)
Â  Â  end)
end

local function DisableAntiAFK()
Â  Â  if antiAFKConnection then
Â  Â  Â  Â  antiAFKConnection:Disconnect()
Â  Â  Â  Â  antiAFKConnection = nil
Â  Â  end
end

-- SIMPLIFIED: KhÃ´ng lá»c NPC - DÃ¹ng cho Farm Map/Farm Random/Auto Attack
local function FindEnemiesInRange(range)
Â  Â  local character = LocalPlayer.Character
Â  Â  if not character or not character:FindFirstChild("HumanoidRootPart") then return {} end
Â  Â  local enemies = {} [cite: 23]
Â  Â  local playerPos = character.HumanoidRootPart.Position [cite: 23]
Â  Â Â 
Â  Â  for _, obj in pairs(workspace:GetDescendants()) do
Â  Â  Â  Â  if obj:IsA("Model") and obj:FindFirstChild("Humanoid") and obj:FindFirstChild("Head") then [cite: 24]
Â  Â  Â  Â  Â  Â  local isPlayer = false
Â  Â  Â  Â  Â  Â  for _, player in pairs(Players:GetPlayers()) do
Â  Â  Â  Â  Â  Â  Â  Â  if player.Character == obj then isPlayer = true; break end [cite: 24]
Â  Â  Â  Â  Â  Â  end
Â  Â  Â  Â  Â  Â  if not isPlayer and obj.Humanoid.Health > 0 then [cite: 24]
Â  Â  Â  Â  Â  Â  Â  Â  local distance = (playerPos - obj.Head.Position).Magnitude
Â  Â  Â  Â  Â  Â  Â  Â  if distance <= (range or 100) then
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  table.insert(enemies, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Model = obj,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Name = obj.Name,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Position = obj.Head.Position, [cite: 25]
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Distance = distance, [cite: 25]
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Health = obj.Humanoid.Health, [cite: 25]
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  MaxHealth = obj.Humanoid.MaxHealth
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  Â  Â  end
Â  Â  Â  Â  Â  Â  end
Â  Â  Â  Â  end
Â  Â  end
Â  Â  table.sort(enemies, function(a, b) return a.Distance < b.Distance end)
Â  Â  return enemies
end

-- NEW: HÃ m tÃ¬m enemies trong dungeon (DÃ¹ng láº¡i FindEnemiesInRange)
local function FindDungeonEnemies(range)
Â  Â  -- DÃ¹ng range lá»›n hÆ¡n cho Dungeon/Raid Ä‘á»ƒ báº¯t Ä‘Æ°á»£c má»¥c tiÃªu tá»‘t hÆ¡n [cite: 26]
Â  Â  return FindEnemiesInRange(range or 150) [cite: 26]
end

-- Group enemies by name
local function GetEnemyGroups()
Â  Â  local enemies = FindEnemiesInRange(200)
Â  Â  local groups = {}
Â  Â Â 
Â  Â  for _, enemy in ipairs(enemies) do
Â  Â  Â  Â  if not groups[enemy.Name] then
Â  Â  Â  Â  Â  Â  groups[enemy.Name] = {
Â  Â  Â  Â  Â  Â  Â  Â  name = enemy.Name,
Â  Â  Â  Â  Â  Â  Â  Â  count = 0,
Â  Â  Â  Â  Â  Â  Â  Â  nearestDistance = math.huge
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  end
Â  Â  Â  Â Â 
Â  Â  Â  Â  groups[enemy.Name].count = groups[enemy.Name].count + 1 [cite: 27]
Â  Â  Â  Â  if enemy.Distance < groups[enemy.Name].nearestDistance then
Â  Â  Â  Â  Â  Â  groups[enemy.Name].nearestDistance = enemy.Distance [cite: 27]
Â  Â  Â  Â  end
Â  Â  end
Â  Â Â 
Â  Â  return groups
end

-- Auto farm logic
local function FarmSelectedLogic()
Â  Â  if #selectedEnemyNames == 0 then return end [cite: 27]
Â  Â Â 
Â  Â  local character = LocalPlayer.Character
Â  Â  if not character or not character:FindFirstChild("HumanoidRootPart") then return end
Â  Â Â 
Â  Â  local enemies = FindEnemiesInRange(200)
Â  Â  local targets = {}
Â  Â Â 
Â  Â  for _, enemy in ipairs(enemies) do
Â  Â  Â  Â  for _, selectedName in ipairs(selectedEnemyNames) do
Â  Â  Â  Â  Â  Â  if enemy.Name == selectedName then
Â  Â  Â  Â  Â  Â  Â  Â  table.insert(targets, enemy) [cite: 28]
Â  Â  Â  Â  Â  Â  Â  Â  breakÂ 
Â  Â  Â  Â  Â  Â  end
Â  Â  Â  Â  end
Â  Â  end
Â  Â Â 
Â  Â  table.sort(targets, function(a, b) return a.Distance < b.Distance end)
Â  Â Â 
Â  Â  if #targets == 0 then return end [cite: 28]
Â  Â Â 
Â  Â  for _, target in ipairs(targets) do
Â  Â  Â  Â  if not activeLoops["FarmSelected"] then break endÂ  [cite: 28]
Â  Â  Â  Â Â 
Â  Â  Â  Â  if target.Model and target.Model:FindFirstChild("Humanoid") and target.Model.Humanoid.Health > 0 then
Â  Â  Â  Â  Â  Â  local offset = Vector3.new(
Â  Â  Â  Â  Â  Â  Â  Â  random:NextInteger(-15, 15) / 10,
Â  Â  Â  Â  Â  Â  Â  Â  3, [cite: 29]
Â  Â  Â  Â  Â  Â  Â  Â  random:NextInteger(-15, 15) / 10
Â  Â  Â  Â  Â  Â  )
Â  Â  Â  Â  Â  Â  SafeWait()Â 
Â  Â  Â  Â  Â  Â  character.HumanoidRootPart.CFrame = CFrame.new(target.Position + offset) [cite: 29]
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  local remote = ReplicatedStorage:FindFirstChild("RemoteEvent") or ReplicatedStorage:FindFirstChild("Remote")
Â  Â  Â  Â  Â  Â  if remote thenÂ 
Â  Â  Â  Â  Â  Â  Â  Â  SafeFire(remote, "Attack", target.Model)
Â  Â  Â  Â  Â  Â  Â  Â  task.wait(0.05) [cite: 29]
Â  Â  Â  Â  Â  Â  Â  Â  SafeFire(remote, "Attack", target.Model)
Â  Â  Â  Â  Â  Â  end
Â  Â  Â  Â  end
Â  Â  Â  Â  task.wait(0.1)Â  [cite: 30]
Â  Â  end
end

-- Auto farm dungeon logic (ÄÃƒ FIX Lá»–I FARM á»ž GIá»®A VÃ€ TARGET)Â 
local function FarmDungeonLogic()
Â  Â  local character = LocalPlayer.Character
Â  Â  if not character or not character:FindFirstChild("HumanoidRootPart") then return end
Â  Â Â 
Â  Â  if not originalPosition then
Â  Â  Â  Â  originalPosition = character.HumanoidRootPart.Position [cite: 30]
Â  Â  end
Â  Â Â 
Â  Â  -- NEW LOGIC: Kiá»ƒm tra Ä‘iá»u kiá»‡n thoÃ¡t theo Wave/Room
Â  Â  if autoExitDungeonEnabled and exitDungeonWaveNumber > 0 then
Â  Â  Â  Â  local currentWave = ReadWaveFromUI() -- Äá»c tá»« UI
Â  Â  Â  Â Â 
Â  Â  Â  Â  if currentWave >= exitDungeonWaveNumber and currentWave < 500 then -- ThÃªm Ä‘iá»u kiá»‡n < 500 Ä‘á»ƒ trÃ¡nh lá»—i Ä‘á»c UI [cite: 31]
Â  Â  Â  Â  Â  Â  -- Thá»±c hiá»‡n thoÃ¡t vÃ  vá» vá»‹ trÃ­ cÅ©
Â  Â  Â  Â  Â  Â  StopLoop("FarmDungeon")
Â  Â  Â  Â  Â  Â  autoFarmDungeonEnabled = false [cite: 31]
Â  Â  Â  Â  Â  Â  
            local dungeonFarmToggle = tabFrames["ðŸ° DUNGEON"]:FindFirstChild("Toggle_EnableAutoFarmDungeon")
            if dungeonFarmToggle then UpdateToggleButton(dungeonFarmToggle, false) end
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  task.wait(1)
Â  Â  Â  Â  Â  Â  if originalPosition then
Â  Â  Â  Â  Â  Â  Â  Â  character.HumanoidRootPart.CFrame = CFrame.new(originalPosition) [cite: 32]
Â  Â  Â  Â  Â  Â  Â  Â  originalPosition = nil
Â  Â  Â  Â  Â  Â  end
Â  Â  Â  Â  Â  Â  mainStatus.Text = "ðŸšª Dungeon: ÄÃ£ thoÃ¡t á»Ÿ Wave/Room " .. currentWave .. " theo cÃ i Ä‘áº·t!" [cite: 32]
Â  Â  Â  Â  Â  Â  returnÂ  [cite: 33]
Â  Â  Â  Â  end
Â  Â  end

    -- TÃŒM Káºº Äá»ŠCH Gáº¦N NHáº¤T
Â  Â  local enemies = FindDungeonEnemies(150) [cite: 33]
Â  Â Â 
Â  Â  if #enemies > 0 then
        local target = enemies[1] -- Chá»‰ táº­p trung vÃ o káº» Ä‘á»‹ch gáº§n nháº¥t
Â  Â  Â  Â Â 
Â  Â  Â  Â  if target.Model and target.Model:FindFirstChild("Humanoid") and target.Model.Humanoid.Health > 0 then
Â  Â  Â  Â  Â  Â  local offset = Vector3.new(
Â  Â  Â  Â  Â  Â  Â  Â  random:NextInteger(-12, 12) / 10,
Â  Â  Â  Â  Â  Â  Â  Â  2,
Â  Â  Â  Â  Â  Â  Â  Â  random:NextInteger(-12, 12) / 10 [cite: 34]
Â  Â  Â  Â  Â  Â  )
Â  Â  Â  Â  Â  Â  SafeWait()
Â  Â  Â  Â  Â  Â  character.HumanoidRootPart.CFrame = CFrame.new(target.Position + offset) [cite: 34]
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  local remote = ReplicatedStorage:FindFirstChild("RemoteEvent") or ReplicatedStorage:FindFirstChild("Remote")
Â  Â  Â  Â  Â  Â  if remote thenÂ 
Â  Â  Â  Â  Â  Â  Â  Â  SafeFire(remote, "Attack", target.Model)
Â  Â  Â  Â  Â  Â  Â  Â  task.wait(0.05) -- Double attack [cite: 34]
Â  Â  Â  Â  Â  Â  Â  Â  SafeFire(remote, "Attack", target.Model)
Â  Â  Â  Â  Â  Â  end
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  task.wait(0.1) -- TÄƒng tá»‘c Ä‘á»™ farm trong Dungeon [cite: 35]
Â  Â  Â  Â  end
Â  Â  else
Â  Â  Â  Â  -- TrÆ°á»ng há»£p khÃ´ng tÃ¬m tháº¥y káº» Ä‘á»‹ch: cÃ³ thá»ƒ lÃ  Ä‘Ã£ hoÃ n thÃ nh
Â  Â  Â  Â  task.wait(2)
Â  Â  Â  Â Â 
Â  Â  Â  Â  StopLoop("FarmDungeon") [cite: 35]
Â  Â  Â  Â  autoFarmDungeonEnabled = false [cite: 35]
Â  Â  Â  Â Â 
Â  Â  Â  Â  local dungeonFarmToggle = tabFrames["ðŸ° DUNGEON"]:FindFirstChild("Toggle_EnableAutoFarmDungeon")
Â  Â  Â  Â  if dungeonFarmToggle then UpdateToggleButton(dungeonFarmToggle, false) end
Â  Â  Â  Â Â 
Â  Â  Â  Â  -- ThoÃ¡t vÃ  quay vá» vá»‹ trÃ­ Map cÅ©
Â  Â  Â  Â  task.wait(1)
Â  Â  Â  Â  if originalPosition then
Â  Â  Â  Â  Â  Â  character.HumanoidRootPart.CFrame = CFrame.new(originalPosition) [cite: 36]
Â  Â  Â  Â  Â  Â  originalPosition = nil [cite: 36]
Â  Â  Â  Â  end
Â  Â  Â  Â  mainStatus.Text = "âœ… Dungeon: HoÃ n thÃ nh vÃ  tá»± Ä‘á»™ng thoÃ¡t!" [cite: 37]
Â  Â  end
end


-- NEW FUNCTION: Auto farm raid logic (ÄÃƒ FIX Lá»–I FARM á»ž GIá»®A VÃ€ TARGET)Â 
local function FarmRaidLogic()
Â  Â  local character = LocalPlayer.Character
Â  Â  if not character or not character:FindFirstChild("HumanoidRootPart") then return {} end
Â  Â Â 
Â  Â  if not raidOriginalPosition then
Â  Â  Â  Â  raidOriginalPosition = character.HumanoidRootPart.Position [cite: 37]
Â  Â  end
Â  Â Â 
Â  Â  -- NEW LOGIC: Kiá»ƒm tra Ä‘iá»u kiá»‡n thoÃ¡t theo Wave/Room
Â  Â  if autoExitRaidEnabled and exitRaidWaveNumber > 0 then
Â  Â  Â  Â  local currentWave = ReadWaveFromUI() -- Äá»c tá»« UI
Â  Â  Â  Â Â 
Â  Â  Â  Â  if currentWave >= exitRaidWaveNumber and currentWave < 500 then
Â  Â  Â  Â  Â  Â  StopLoop("FarmRaid") [cite: 38]
Â  Â  Â  Â  Â  Â  autoFarmRaidEnabled = false [cite: 38]
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  local raidFarmToggleFrame = tabFrames["ðŸ° DUNGEON"]:FindFirstChild("Toggle_EnableAutoFarmRaid")
Â  Â  Â  Â  Â  Â  if raidFarmToggleFrame then UpdateToggleButton(raidFarmToggleFrame, false) end [cite: 38]
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  task.wait(1)
Â  Â  Â  Â  Â  Â  -- Thá»±c hiá»‡n thoÃ¡t vÃ  vá» vá»‹ trÃ­ cÅ© (Map)
Â  Â  Â  Â  Â  Â  if raidOriginalPosition then
Â  Â  Â  Â  Â  Â  Â  Â  character.HumanoidRootPart.CFrame = CFrame.new(raidOriginalPosition) [cite: 39]
Â  Â  Â  Â  Â  Â  Â  Â  raidOriginalPosition = nil [cite: 39]
Â  Â  Â  Â  Â  Â  end
Â  Â  Â  Â  Â  Â  mainStatus.Text = "ðŸšª Raid: ÄÃ£ thoÃ¡t á»Ÿ Wave/Room " .. currentWave .. " theo cÃ i Ä‘áº·t!" [cite: 39]
Â  Â  Â  Â  Â  Â  returnÂ  [cite: 40]
Â  Â  Â  Â  end
Â  Â  end

    -- TÃŒM Káºº Äá»ŠCH Gáº¦N NHáº¤T
Â  Â  local enemies = FindDungeonEnemies(150)Â  [cite: 40]
Â  Â Â 
Â  Â  if #enemies > 0 then
        local target = enemies[1] -- Chá»‰ táº­p trung vÃ o káº» Ä‘á»‹ch gáº§n nháº¥t
Â  Â  Â  Â Â 
Â  Â  Â  Â  if target.Model and target.Model:FindFirstChild("Humanoid") and target.Model.Humanoid.Health > 0 then
Â  Â  Â  Â  Â  Â  local offset = Vector3.new(
Â  Â  Â  Â  Â  Â  Â  Â  random:NextInteger(-12, 12) / 10,
Â  Â  Â  Â  Â  Â  Â  Â  2,
Â  Â  Â  Â  Â  Â  Â  Â  random:NextInteger(-12, 12) / 10 [cite: 41]
Â  Â  Â  Â  Â  Â  )
Â  Â  Â  Â  Â  Â  SafeWait()
Â  Â  Â  Â  Â  Â  character.HumanoidRootPart.CFrame = CFrame.new(target.Position + offset) [cite: 41]
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  local remote = ReplicatedStorage:FindFirstChild("RemoteEvent") or ReplicatedStorage:FindFirstChild("Remote")
Â  Â  Â  Â  Â  Â  if remote thenÂ 
Â  Â  Â  Â  Â  Â  Â  Â  SafeFire(remote, "Attack", target.Model)
Â  Â  Â  Â  Â  Â  Â  Â  task.wait(0.05) -- Double attack [cite: 41]
Â  Â  Â  Â  Â  Â  Â  Â  SafeFire(remote, "Attack", target.Model)
Â  Â  Â  Â  Â  Â  end
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  task.wait(0.1) -- TÄƒng tá»‘c Ä‘á»™ farm trong Raid [cite: 42]
Â  Â  Â  Â  end
Â  Â  else
Â  Â  Â  Â  -- TrÆ°á»ng há»£p khÃ´ng tÃ¬m tháº¥y káº» Ä‘á»‹ch: cÃ³ thá»ƒ lÃ  Ä‘Ã£ hoÃ n thÃ nh
Â  Â  Â  Â  task.wait(2) [cite: 42]
Â  Â  Â  Â Â 
Â  Â  Â  Â  StopLoop("FarmRaid") [cite: 42]
Â  Â  Â  Â  autoFarmRaidEnabled = false [cite: 42]
Â  Â  Â  Â Â 
Â  Â  Â  Â  local raidFarmToggleFrame = tabFrames["ðŸ° DUNGEON"]:FindFirstChild("Toggle_EnableAutoFarmRaid")
Â  Â  Â  Â  if raidFarmToggleFrame then UpdateToggleButton(raidFarmToggleFrame, false) end [cite: 42]
Â  Â  Â  Â Â 
Â  Â  Â  Â  -- ThoÃ¡t vÃ  quay vá» vá»‹ trÃ­ Map cÅ©
Â  Â  Â  Â  task.wait(1)
Â  Â  Â  Â  if raidOriginalPosition then
Â  Â  Â  Â  Â  Â  character.HumanoidRootPart.CFrame = CFrame.new(raidOriginalPosition) [cite: 43]
Â  Â  Â  Â  Â  Â  raidOriginalPosition = nil [cite: 43]
Â  Â  Â  Â  end
Â  Â  Â  Â  mainStatus.Text = "âœ… Raid: HoÃ n thÃ nh vÃ  tá»± Ä‘á»™ng thoÃ¡t!" [cite: 44]
Â  Â  end
end

-- NEW FUNCTION: Auto Rank Up Logic
local function AutoRankUpLogic()
Â  Â  if autoRankUpEnabled then
Â  Â  Â  Â  local remote = ReplicatedStorage:FindFirstChild("Reply") and ReplicatedStorage.Reply:FindFirstChild("Reliable")
Â  Â  Â  Â  if remote then
Â  Â  Â  Â  Â  Â  SafeFire(remote, "RankUp")
Â  Â  Â  Â  end
Â  Â  end
end

-- NEW: Auto stat logic
local function AutoStatLogic()
Â  Â  if autoStatEnabled then
Â  Â  Â  Â  DistributeStat(selectedStat)
Â  Â  end
end

-- NEW: Auto hatch egg logic
local function AutoHatchEggLogic()
Â  Â  if autoHatchEggEnabled then
Â  Â  Â  Â  local remote = ReplicatedStorage:FindFirstChild("Reply") and ReplicatedStorage.Reply:FindFirstChild("Reliable")
Â  Â  Â  Â  if remote then
Â  Â  Â  Â  Â  Â  local function getNil(name,class) for _,v in next, getnilinstances() do if v.ClassName==class and v.Name==name then return v;end end end [cite: 45]
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  local args = {
Â  Â  Â  Â  Â  Â  Â  Â  [1] = "Gacha Auto",Â 
Â  Â  Â  Â  Â  Â  Â  Â  [2] = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  [1] = getNil("InputObject", "InputObject"),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  [2] = 0
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  SafeFire(remote, unpack(args)) [cite: 3]
Â  Â  Â  Â  end
Â  Â  end
end

-- Auto farm logic
local function AutoAttackLogic()
Â  Â  local enemies = FindEnemiesInRange(50) [cite: 46]
Â  Â  if #enemies > 0 then
Â  Â  Â  Â  local nearestEnemy = enemies[1] [cite: 46]
Â  Â  Â  Â  local character = LocalPlayer.Character
Â  Â  Â  Â Â 
Â  Â  Â  Â  if character and character:FindFirstChild("HumanoidRootPart") then
Â  Â  Â  Â  Â  Â  local offset = Vector3.new(
Â  Â  Â  Â  Â  Â  Â  Â  random:NextInteger(-8, 8) / 10,
Â  Â  Â  Â  Â  Â  Â  Â  2,
Â  Â  Â  Â  Â  Â  Â  Â  random:NextInteger(-8, 8) / 10
Â  Â  Â  Â  Â  Â  )
Â  Â  Â  Â  Â  Â  SafeWait()
Â  Â  Â  Â  Â  Â  character.HumanoidRootPart.CFrame = CFrame.new(nearestEnemy.Position + offset) [cite: 47]
Â  Â  Â  Â  Â  Â  local remote = ReplicatedStorage:FindFirstChild("RemoteEvent") or ReplicatedStorage:FindFirstChild("Remote")
Â  Â  Â  Â  Â  Â  if remote then SafeFire(remote, "Attack", nearestEnemy.Model) end [cite: 47]
Â  Â  Â  Â  end
Â  Â  end
end

local function FarmRandomLogic()
Â  Â  local enemies = FindEnemiesInRange(50)
Â  Â  if #enemies > 0 then
Â  Â  Â  Â  local randomEnemy = enemies[random:NextInteger(1, #enemies)] [cite: 47]
Â  Â  Â  Â  local character = LocalPlayer.Character
Â  Â  Â  Â  if character and character:FindFirstChild("HumanoidRootPart") then
Â  Â  Â  Â  Â  Â  local offset = Vector3.new(
Â  Â  Â  Â  Â  Â  Â  Â  random:NextInteger(-8, 8) / 10,
Â  Â  Â  Â  Â  Â  Â  Â  2,
Â  Â  Â  Â  Â  Â  Â  Â  random:NextInteger(-8, 8) / 10 [cite: 48]
Â  Â  Â  Â  Â  Â  )
Â  Â  Â  Â  Â  Â  SafeWait()
Â  Â  Â  Â  Â  Â  character.HumanoidRootPart.CFrame = CFrame.new(randomEnemy.Position + offset) [cite: 48]
Â  Â  Â  Â  Â  Â  local remote = ReplicatedStorage:FindFirstChild("RemoteEvent") or ReplicatedStorage:FindFirstChild("Remote")
Â  Â  Â  Â  Â  Â  if remote then SafeFire(remote, "Attack", randomEnemy.Model) end [cite: 48]
Â  Â  Â  Â  end
Â  Â  end
end

local function AutoCollectLogic()
Â  Â  local character = LocalPlayer.Character
Â  Â  if not character then return end
Â  Â  for _, obj in pairs(workspace:GetDescendants()) do
Â  Â  Â  Â  if obj:IsA("Part") and (obj.Name:lower():find("drop") or obj.Name:lower():find("coin") or obj.Name:lower():find("reward")) then
Â  Â  Â  Â  Â  Â  local distance = (character.HumanoidRootPart.Position - obj.Position).Magnitude [cite: 49]
Â  Â  Â  Â  Â  Â  if distance < 20 then
Â  Â  Â  Â  Â  Â  Â  Â  local remote = ReplicatedStorage:FindFirstChild("RemoteEvent") or ReplicatedStorage:FindFirstChild("Remote")
Â  Â  Â  Â  Â  Â  Â  Â  if remote then SafeFire(remote, "Collect", obj) end [cite: 49]
Â  Â  Â  Â  Â  Â  end
Â  Â  Â  Â  end
Â  Â  end
end

-- CÃ¡c hÃ m cÆ¡ báº£n
local function StartGacha(gachaType)
Â  Â  local remote = ReplicatedStorage:FindFirstChild("Reply") and ReplicatedStorage.Reply:FindFirstChild("Reliable") [cite: 49]
Â  Â  if remote then
Â  Â  Â  Â  SafeFire(remote, "Crate Roll Start", {[1]=gachaType,[2]=true}) [cite: 4]
Â  Â  Â  Â  task.wait(1)
Â  Â  Â  Â  SafeFire(remote, "Crate Roll Stop") [cite: 4]
Â  Â  end
end

local function TeleportToZone(zoneName)
Â  Â  local remote = ReplicatedStorage:FindFirstChild("Reply") and ReplicatedStorage.Reply:FindFirstChild("Reliable") [cite: 50]
Â  Â  if remote then
Â  Â  Â  Â  -- Táº¯t táº¥t cáº£ cÃ¡c loáº¡i farm khi Teleport
Â  Â  Â  Â  StopLoop("FarmDungeon") [cite: 50]
Â  Â  Â  Â  StopLoop("FarmRaid") [cite: 50]
Â  Â  Â  Â  autoFarmDungeonEnabled = false [cite: 50]
Â  Â  Â  Â  autoFarmRaidEnabled = false [cite: 50]
Â  Â  Â  Â  -- Cáº­p nháº­t UI náº¿u cáº§n (chÆ°a implement trong hÃ m nÃ y)

Â  Â  Â  Â  SafeFire(remote, "Zone Teleport", {[1]=zoneName}) [cite: 1]
Â  Â  end
end

local function DistributeStat(statName)
Â  Â  local remote = ReplicatedStorage:FindFirstChild("Reply") and ReplicatedStorage.Reply:FindFirstChild("Reliable")
Â  Â  if remote then
Â  Â  Â  Â  SafeFire(remote, "Distribute Stat Point", {[1]=statName}) [cite: 7]
Â  Â  end
end

-- NEW: Join dungeon function (LÆ¯U Vá»Š TRÃ Gá»C)
local function JoinDungeon(mode)
Â  Â  local remote = ReplicatedStorage:FindFirstChild("Reply") and ReplicatedStorage.Reply:FindFirstChild("Reliable") [cite: 51]
Â  Â  if remote then
Â  Â  Â  Â  local modeNumber
Â  Â  Â  Â  if mode == "Easy" then
Â  Â  Â  Â  Â  Â  modeNumber = "1"
Â  Â  Â  Â  elseif mode == "Medium" then
Â  Â  Â  Â  Â  Â  modeNumber = "2"
Â  Â  Â  Â  elseif mode == "Hard" then
Â  Â  Â  Â  Â  Â  modeNumber = "3"
Â  Â  Â  Â  else
Â  Â  Â  Â  Â  Â  modeNumber = "1"
Â  Â  Â  Â  end
Â  Â  Â  Â Â 
Â  Â  Â  Â  local dungeonCode = "Dungeon:" .. modeNumber
Â  Â  Â  Â Â 
Â  Â  Â  Â  -- LÆ¯U Vá»Š TRÃ Gá»C TRÆ¯á»šC KHI VÃ€O DUNGEON
Â  Â  Â  Â  originalPosition = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") and LocalPlayer.Character.HumanoidRootPart.Position [cite: 52]
Â  Â  Â  Â Â 
Â  Â  Â  Â  SafeFire(remote, "Join Gamemode", {[1]=dungeonCode}) [cite: 8]
Â  Â  Â  Â Â 
Â  Â  Â  Â  task.wait(3) -- Äá»£i 3s Ä‘á»ƒ Teleport xong
Â  Â  Â  Â Â 
Â  Â  Â  Â  -- KÃ­ch hoáº¡t farm ngay sau khi join náº¿u toggle farm Ä‘ang báº­t
Â  Â  Â  Â  if autoFarmDungeonEnabled and not activeLoops["FarmDungeon"] then
Â  Â  Â  Â  Â  Â  StartLoop("FarmDungeon", FarmDungeonLogic, 0.2)
Â  Â  Â  Â  end
Â  Â  end
end

-- NEW: Join raid function (LÆ¯U Vá»Š TRÃ Gá»C)
local function JoinRaid()
Â  Â  local remote = ReplicatedStorage:FindFirstChild("Reply") and ReplicatedStorage.Reply:FindFirstChild("Reliable") [cite: 53]
Â  Â  if remote then
Â  Â  Â  Â  local raidCode = "Raid:1" [cite: 53]
Â  Â  Â  Â Â 
Â  Â  Â  Â  -- LÆ¯U Vá»Š TRÃ Gá»C TRÆ¯á»šC KHI VÃ€O RAID
Â  Â  Â  Â  raidOriginalPosition = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") and LocalPlayer.Character.HumanoidRootPart.Position [cite: 53]
Â  Â  Â  Â Â 
Â  Â  Â  Â  SafeFire(remote, "Join Gamemode", {[1]=raidCode}) [cite: 7]
Â  Â  Â  Â Â 
Â  Â  Â  Â  task.wait(3) -- Äá»£i 3s Ä‘á»ƒ Teleport xong
Â  Â  Â  Â Â 
Â  Â  Â  Â  -- KÃ­ch hoáº¡t farm ngay sau khi join náº¿u toggle farm Ä‘ang báº­t
Â  Â  Â  Â  if autoFarmRaidEnabled and not activeLoops["FarmRaid"] then
Â  Â  Â  Â  Â  Â  StartLoop("FarmRaid", FarmRaidLogic, 0.2)
Â  Â  Â  Â  end [cite: 54]
Â  Â  end
end

-- Auto Open Egg vá»›i logic kiá»ƒm tra khoáº£ng cÃ¡ch
local function AutoOpenEggLogic()
Â  Â  local character = LocalPlayer.Character
Â  Â  if not character or not character:FindFirstChild("HumanoidRootPart") then return end [cite: 54]
Â  Â Â 
Â  Â  for _, obj in pairs(workspace:GetDescendants()) do
Â  Â  Â  Â  if obj:IsA("Model") and (obj.Name:lower():find("egg") or obj.Name:lower():find("crate")) then
Â  Â  Â  Â  Â  Â  local distance = (character.HumanoidRootPart.Position - obj:GetPivot().Position).Magnitude
Â  Â  Â  Â  Â  Â  if distance < 15 then
Â  Â  Â  Â  Â  Â  Â  Â  local remote = ReplicatedStorage:FindFirstChild("Reply") and ReplicatedStorage.Reply:FindFirstChild("Reliable") [cite: 54]
Â  Â  Â  Â  Â  Â  Â  Â  if remote then
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  local function getNil(name,class) for _,v in next, getnilinstances() do if v.ClassName==class and v.Name==name then return v;end end end [cite: 55]
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  local args = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  [1] = "Gacha Auto",Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  [2] = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  [1] = getNil("InputObject", "InputObject"),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  [2] = 0
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  SafeFire(remote, unpack(args)) [cite: 56]
Â  Â  Â  Â  Â  Â  Â  Â  end
Â  Â  Â  Â  Â  Â  Â  Â  break
Â  Â  Â  Â  Â  Â  end
Â  Â  Â  Â  end
Â  Â  end
end

-- NEW: Config Profiles System (Giá»¯ nguyÃªn cÃ¡c hÃ m Save/Load)
local function SaveProfiles()
Â  Â  local data = {
Â  Â  Â  Â  profiles = configProfiles,
Â  Â  Â  Â  autoLoadProfile = autoLoadProfile
Â  Â  }
Â  Â  local encoded = HttpService:JSONEncode(data)
Â  Â  writefile(profilesFile, encoded)
end

local function LoadProfiles()
Â  Â  if isfile(profilesFile) then [cite: 57]
Â  Â  Â  Â  local success, data = pcall(function()
Â  Â  Â  Â  Â  Â  local encoded = readfile(profilesFile)
Â  Â  Â  Â  Â  Â  return HttpService:JSONDecode(encoded) [cite: 57]
Â  Â  Â  Â  end)
Â  Â  Â  Â  if success and data then
Â  Â  Â  Â  Â  Â  configProfiles = data.profiles or {} [cite: 57]
Â  Â  Â  Â  Â  Â  autoLoadProfile = data.autoLoadProfile or "" [cite: 57]
Â  Â  Â  Â  end
Â  Â  end
end

local function SaveConfig()
Â  Â  local data = {
Â  Â  Â  Â  selectedEnemyNames = selectedEnemyNames, [cite: 58]
Â  Â  Â  Â  selectedGachaType = selectedGachaType, [cite: 58]
Â  Â  Â  Â  selectedZone = selectedZone, [cite: 58]
Â  Â  Â  Â  selectedStat = selectedStat, [cite: 58]
Â  Â  Â  Â  autoOpenEggEnabled = autoOpenEggEnabled, [cite: 58]
Â  Â  Â  Â  autoStatEnabled = autoStatEnabled, [cite: 58]
Â  Â  Â  Â  autoHatchEggEnabled = autoHatchEggEnabled, [cite: 58]
Â  Â  Â  Â  autoRankUpEnabled = autoRankUpEnabled, -- SAVE NEW Toggle [cite: 58]
Â  Â  Â  Â  stealthMode = stealthMode, [cite: 58]
Â  Â  Â  Â Â 
Â  Â  Â  Â  -- Dungeon settings
Â  Â  Â  Â  selectedDungeonMode = selectedDungeonMode, [cite: 58]
Â  Â  Â  Â  autoFarmDungeonEnabled = autoFarmDungeonEnabled,Â  [cite: 58]
Â  Â  Â  Â  autoJoinDungeonEnabled = autoJoinDungeonEnabled,Â  [cite: 58]
Â  Â  Â  Â  autoJoinRaidEnabled = autoJoinRaidEnabled, [cite: 58]
Â  Â  Â  Â  autoFarmRaidEnabled = autoFarmRaidEnabled,Â  [cite: 58]
Â  Â  Â  Â Â 
Â  Â  Â  Â  -- NEW Exit Toggles/Values
Â  Â  Â  Â  autoExitDungeonEnabled = autoExitDungeonEnabled, [cite: 59]
Â  Â  Â  Â  autoExitRaidEnabled = autoExitRaidEnabled, [cite: 59]
Â  Â  Â  Â  exitDungeonWaveNumber = exitDungeonWaveNumber,Â  [cite: 59]
Â  Â  Â  Â  exitRaidWaveNumber = exitRaidWaveNumber,Â  Â  Â  [cite: 59]
Â  Â  Â  Â Â 
Â  Â  Â  Â  -- Toggle states
Â  Â  Â  Â  selectedFarmEnabled = selectedFarmEnabled,Â  [cite: 59]
Â  Â  Â  Â  autoAttackEnabled = autoAttackEnabled, [cite: 59]
Â  Â  Â  Â  farmRandomEnabled = farmRandomEnabled, [cite: 59]
Â  Â  Â  Â  autoCollectEnabled = autoCollectEnabled, [cite: 59]
Â  Â  Â  Â  stealthModeEnabled = stealthMode, [cite: 59]
Â  Â  Â  Â  antiAFKEnabled = antiAFKEnabled [cite: 59]
Â  Â  }
Â  Â Â 
Â  Â  configProfiles[selectedConfigProfile] = data
Â  Â  SaveProfiles()
end

local function LoadConfig(profileName)
Â  Â  if not profileName then profileName = selectedConfigProfile end
Â  Â Â 
Â  Â  if configProfiles[profileName] then
Â  Â  Â  Â  local data = configProfiles[profileName]
Â  Â  Â  Â Â 
Â  Â  Â  Â  selectedEnemyNames = data.selectedEnemyNames or {} [cite: 60]
Â  Â  Â  Â  selectedGachaType = data.selectedGachaType or "Biju" [cite: 60]
Â  Â  Â  Â  selectedZone = data.selectedZone or "Zone 1" [cite: 60]
Â  Â  Â  Â  selectedStat = data.selectedStat or "Mastery" [cite: 60]
Â  Â  Â  Â  autoOpenEggEnabled = data.autoOpenEggEnabled or false [cite: 60]
Â  Â  Â  Â  autoStatEnabled = data.autoStatEnabled or false [cite: 60]
Â  Â  Â  Â  autoHatchEggEnabled = data.autoHatchEggEnabled or false [cite: 60]
Â  Â  Â  Â  autoRankUpEnabled = data.autoRankUpEnabled or false -- LOAD NEW Toggle [cite: 60]
Â  Â  Â  Â  stealthMode = data.stealthMode or true [cite: 60]
Â  Â  Â  Â Â 
Â  Â  Â  Â  -- Dungeon settings
Â  Â  Â  Â  selectedDungeonMode = data.selectedDungeonMode or "Easy" [cite: 60]
Â  Â  Â  Â  autoFarmDungeonEnabled = data.autoFarmDungeonEnabled or false [cite: 60]
Â  Â  Â  Â  autoJoinDungeonEnabled = data.autoJoinDungeonEnabled or false [cite: 60]
Â  Â  Â  Â  autoJoinRaidEnabled = data.autoJoinRaidEnabled or false [cite: 61]
Â  Â  Â  Â  autoFarmRaidEnabled = data.autoFarmRaidEnabled or falseÂ  [cite: 61]
Â  Â  Â  Â Â 
Â  Â  Â  Â  -- NEW Exit Toggles/Values
Â  Â  Â  Â  autoExitDungeonEnabled = data.autoExitDungeonEnabled or false [cite: 61]
Â  Â  Â  Â  autoExitRaidEnabled = data.autoExitRaidEnabled or false [cite: 61]
Â  Â  Â  Â  exitDungeonWaveNumber = data.exitDungeonWaveNumber or 0Â  [cite: 61]
Â  Â  Â  Â  exitRaidWaveNumber = data.exitRaidWaveNumber or 0Â  Â  Â  [cite: 61]
Â  Â  Â  Â Â 
Â  Â  Â  Â  -- Toggle states
Â  Â  Â  Â  selectedFarmEnabled = data.selectedFarmEnabled or false [cite: 61]
Â  Â  Â  Â  autoAttackEnabled = data.autoAttackEnabled or false [cite: 61]
Â  Â  Â  Â  farmRandomEnabled = data.farmRandomEnabled or false [cite: 61]
Â  Â  Â  Â  autoCollectEnabled = data.autoCollectEnabled or false [cite: 61]
Â  Â  Â  Â  stealthModeEnabled = data.stealthModeEnabled or true [cite: 62]
Â  Â  Â  Â  antiAFKEnabled = data.antiAFKEnabled or true [cite: 62]
Â  Â  Â  Â Â 
Â  Â  Â  Â  return true
Â  Â  end
Â  Â  return false
end

local function DeleteConfig(profileName)
Â  Â  if not profileName then profileName = selectedConfigProfile end
Â  Â Â 
Â  Â  if configProfiles[profileName] then
Â  Â  Â  Â  configProfiles[profileName] = nil
Â  Â  Â  Â Â 
Â  Â  Â  Â  if autoLoadProfile == profileName then
Â  Â  Â  Â  Â  Â  autoLoadProfile = ""
Â  Â  Â  Â  end
Â  Â  Â  Â Â 
Â  Â  Â  Â  SaveProfiles()
Â  Â  Â  Â  return true
Â  Â  end
Â  Â  return false
end

local function CreateNewProfile(profileName)
Â  Â  if not profileName or profileName == "" then return false end [cite: 63]
Â  Â Â 
Â  Â  if not configProfiles[profileName] then
Â  Â  Â  Â  configProfiles[profileName] = {
Â  Â  Â  Â  Â  Â  selectedEnemyNames = {}, [cite: 63]
Â  Â  Â  Â  Â  Â  selectedGachaType = "Biju", [cite: 63]
Â  Â  Â  Â  Â  Â  selectedZone = "Zone 1", [cite: 63]
Â  Â  Â  Â  Â  Â  selectedStat = "Mastery", [cite: 63]
Â  Â  Â  Â  Â  Â  autoOpenEggEnabled = false, [cite: 63]
Â  Â  Â  Â  Â  Â  autoStatEnabled = false, [cite: 63]
Â  Â  Â  Â  Â  Â  autoHatchEggEnabled = false, [cite: 63]
Â  Â  Â  Â  Â  Â  autoRankUpEnabled = false, -- NEW [cite: 63]
Â  Â  Â  Â  Â  Â  stealthMode = true, [cite: 63]
Â  Â  Â  Â  Â  Â  selectedDungeonMode = "Easy", [cite: 63]
Â  Â  Â  Â  Â  Â  autoFarmDungeonEnabled = false, [cite: 64]
Â  Â  Â  Â  Â  Â  autoJoinDungeonEnabled = false, [cite: 64]
Â  Â  Â  Â  Â  Â  autoJoinRaidEnabled = false, [cite: 64]
Â  Â  Â  Â  Â  Â  autoFarmRaidEnabled = false,Â  [cite: 64]
Â  Â  Â  Â  Â  Â  autoExitDungeonEnabled = false, [cite: 64]
Â  Â  Â  Â  Â  Â  autoExitRaidEnabled = false, [cite: 64]
Â  Â  Â  Â  Â  Â  exitDungeonWaveNumber = 0,Â  [cite: 64]
Â  Â  Â  Â  Â  Â  exitRaidWaveNumber = 0,Â  [cite: 64]
Â  Â  Â  Â  Â  Â  selectedFarmEnabled = false, [cite: 64]
Â  Â  Â  Â  Â  Â  autoAttackEnabled = false, [cite: 64]
Â  Â  Â  Â  Â  Â  farmRandomEnabled = false, [cite: 64]
Â  Â  Â  Â  Â  Â  autoCollectEnabled = false, [cite: 64]
Â  Â  Â  Â  Â  Â  stealthModeEnabled = true, [cite: 64]
Â  Â  Â  Â  Â  Â  antiAFKEnabled = true [cite: 65]
Â  Â  Â  Â  }
Â  Â  Â  Â Â 
Â  Â  Â  Â  SaveProfiles()
Â  Â  Â  Â  return true
Â  Â  end
Â  Â  return false
end

local function SetAutoLoadProfile(profileName)
Â  Â  if configProfiles[profileName] then
Â  Â  Â  Â  autoLoadProfile = profileName
Â  Â  Â  Â  SaveProfiles()
Â  Â  Â  Â  return true
Â  Â  end
Â  Â  return false
end

-- GUI Initialization vá»›i theme má»›i (Giá»¯ nguyÃªn v4.3 UI)
local HimonoHub = Instance.new("ScreenGui")
HimonoHub.Name = "HimonoHubDark"
HimonoHub.ResetOnSpawn = false
HimonoHub.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
HimonoHub.Parent = game.CoreGui
HimonoHub.Enabled = true

-- MINI UI (NÃºt Neo) - Dark Theme
local HimonoMini = Instance.new("ScreenGui")
HimonoMini.Name = "HimonoHubMini"
HimonoMini.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
HimonoMini.Enabled = false
HimonoMini.Parent = game.CoreGui

local MiniButton = Instance.new("TextButton")
MiniButton.Size = UDim2.new(0, 50, 0, 50) [cite: 66]
MiniButton.Position = UDim2.new(1, -60, 0, 20) [cite: 66]
MiniButton.BackgroundColor3 = ColorTheme.Accent [cite: 66]
MiniButton.Text = "âš¡" [cite: 66]
MiniButton.TextColor3 = ColorTheme.Text [cite: 66]
MiniButton.Font = Enum.Font.GothamBold [cite: 66]
MiniButton.TextSize = 20 [cite: 66]
MiniButton.Parent = HimonoMini [cite: 66]

local MiniCorner = Instance.new("UICorner")
MiniCorner.CornerRadius = UDim.new(0.3, 0)
MiniCorner.Parent = MiniButton

local MiniStroke = Instance.new("UIStroke")
MiniStroke.Color = Color3.fromRGB(100, 150, 255)
MiniStroke.Thickness = 2
MiniStroke.Parent = MiniButton

-- Hover effect cho mini button
SafeConnect(MiniButton.MouseEnter, function()
Â  Â  TweenService:Create(MiniButton, TweenInfo.new(0.2), {BackgroundColor3 = ColorTheme.AccentHover}):Play()
end)

SafeConnect(MiniButton.MouseLeave, function()
Â  Â  TweenService:Create(MiniButton, TweenInfo.new(0.2), {BackgroundColor3 = ColorTheme.Accent}):Play()
end)

-- HÃ€M áº¨N/HIá»†N (Global Toggle)
local function ToggleUI(showMain)
Â  Â  if showMain then
Â  Â  Â  Â  HimonoHub.Enabled = true
Â  Â  Â  Â  HimonoMini.Enabled = false
Â  Â  else
Â  Â  Â  Â  HimonoHub.Enabled = false
Â  Â  Â  Â  HimonoMini.Enabled = true
Â  Â  end
end

SafeConnect(MiniButton.MouseButton1Click, function()
Â  Â  ToggleUI(true)
end)

-- Táº¡o Main Container vá»›i theme dark
local MainContainer = Instance.new("Frame")
MainContainer.Size = UDim2.new(0, 650, 0, 600) [cite: 67]
MainContainer.Position = UDim2.new(0.5, -325, 0.5, -300) [cite: 67]
MainContainer.BackgroundColor3 = ColorTheme.Background [cite: 67]
MainContainer.BorderSizePixel = 0 [cite: 67]
MainContainer.Parent = HimonoHub [cite: 67]

local ContainerCorner = Instance.new("UICorner")
ContainerCorner.CornerRadius = UDim.new(0.03, 0)
ContainerCorner.Parent = MainContainer

local ContainerStroke = Instance.new("UIStroke")
ContainerStroke.Color = Color3.fromRGB(40, 40, 50)
ContainerStroke.Thickness = 2
ContainerStroke.Parent = MainContainer

-- Title Bar
local TitleBar = Instance.new("Frame")
TitleBar.Size = UDim2.new(1, 0, 0, 50) [cite: 67]
TitleBar.BackgroundColor3 = ColorTheme.Secondary [cite: 67]
TitleBar.BorderSizePixel = 0 [cite: 67]
TitleBar.Parent = MainContainer [cite: 67]

local TitleCorner = Instance.new("UICorner")
TitleCorner.CornerRadius = UDim.new(0.03, 0)
TitleCorner.Parent = TitleBar

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, -100, 1, 0) [cite: 67]
Title.BackgroundTransparency = 1 [cite: 67]
Title.Text = "âš¡ HIMONO HUB v4.3 - DARK EDITION (FINAL FIX)" [cite: 67, 68]
Title.TextColor3 = ColorTheme.Text [cite: 68]
Title.Font = Enum.Font.GothamBold [cite: 68]
Title.TextSize = 16 [cite: 68]
Title.TextXAlignment = Enum.TextXAlignment.Left [cite: 68]
Title.Position = UDim2.new(0, 15, 0, 0) [cite: 68]
Title.Parent = TitleBar [cite: 68]

-- Stealth Indicator
local StealthIndicator = Instance.new("Frame")
StealthIndicator.Size = UDim2.new(0, 12, 0, 12) [cite: 68]
StealthIndicator.Position = UDim2.new(1, -90, 0.5, -6) [cite: 68]
StealthIndicator.BackgroundColor3 = stealthMode and ColorTheme.Success or ColorTheme.Danger [cite: 68]
StealthIndicator.Parent = TitleBar [cite: 68]

local StealthCorner = Instance.new("UICorner")
StealthCorner.CornerRadius = UDim.new(1, 0)
StealthCorner.Parent = StealthIndicator

local StealthLabel = Instance.new("TextLabel")
StealthLabel.Size = UDim2.new(0, 80, 1, 0) [cite: 68]
StealthLabel.Position = UDim2.new(1, -80, 0, 0) [cite: 68]
StealthLabel.BackgroundTransparency = 1 [cite: 68]
StealthLabel.Text = stealthMode and "STEALTH: ON" or "STEALTH: OFF" [cite: 68]
StealthLabel.TextColor3 = stealthMode and ColorTheme.Success or ColorTheme.Danger [cite: 68]
StealthLabel.Font = Enum.Font.Gotham [cite: 68]
StealthLabel.TextSize = 10 [cite: 68]
StealthLabel.Parent = TitleBar [cite: 68]

-- Hide Button
local HideButton = Instance.new("TextButton")
HideButton.Name = "HideButton"
HideButton.Size = UDim2.new(0, 30, 0, 30) [cite: 68]
HideButton.Position = UDim2.new(1, -35, 0.5, -15) [cite: 68]
HideButton.BackgroundColor3 = ColorTheme.Accent [cite: 68]
HideButton.Text = "â”€" [cite: 68]
HideButton.TextColor3 = ColorTheme.Text [cite: 68]
HideButton.Font = Enum.Font.GothamBold [cite: 68]
HideButton.TextSize = 16 [cite: 68]
HideButton.Parent = TitleBar [cite: 68]

local HideCorner = Instance.new("UICorner")
HideCorner.CornerRadius = UDim.new(0.2, 0) [cite: 69]
HideCorner.Parent = HideButton [cite: 69]

SafeConnect(HideButton.MouseButton1Click, function()
Â  Â  ToggleUI(false)
end)

-- Tab Container
local TabContainer = Instance.new("ScrollingFrame")
TabContainer.Size = UDim2.new(1, -20, 0, 40) [cite: 69]
TabContainer.Position = UDim2.new(0, 10, 0, 60) [cite: 69]
TabContainer.BackgroundTransparency = 1 [cite: 69]
TabContainer.ScrollBarThickness = 3 [cite: 69]
TabContainer.ScrollBarImageColor3 = ColorTheme.Accent [cite: 69]
TabContainer.CanvasSize = UDim2.new(2, 0, 0, 0) [cite: 69]
TabContainer.Parent = MainContainer [cite: 69]

local TabListLayout = Instance.new("UIListLayout")
TabListLayout.FillDirection = Enum.FillDirection.Horizontal
TabListLayout.Padding = UDim.new(0, 8)
TabListLayout.Parent = TabContainer

-- Content Container
local ContentContainer = Instance.new("Frame")
ContentContainer.Size = UDim2.new(1, -20, 1, -120) [cite: 69]
ContentContainer.Position = UDim2.new(0, 10, 0, 110) [cite: 69]
ContentContainer.BackgroundColor3 = ColorTheme.Secondary [cite: 69]
ContentContainer.Parent = MainContainer [cite: 69]

local ContentCorner = Instance.new("UICorner")
ContentCorner.CornerRadius = UDim.new(0.02, 0)
ContentCorner.Parent = ContentContainer

local ContentScroll = Instance.new("ScrollingFrame")
ContentScroll.Size = UDim2.new(1, 0, 1, 0) [cite: 69]
ContentScroll.BackgroundTransparency = 1 [cite: 69]
ContentScroll.ScrollBarThickness = 5 [cite: 69]
ContentScroll.ScrollBarImageColor3 = ColorTheme.Accent [cite: 69]
ContentScroll.CanvasSize = UDim2.new(0, 0, 2, 0) [cite: 69]
ContentScroll.Parent = ContentContainer [cite: 69]

local ContentLayout = Instance.new("UIListLayout")
ContentLayout.Padding = UDim.new(0, 15)
ContentLayout.Parent = ContentScroll [cite: 70]

-- Tabs
local tabs = {
Â  Â  "ðŸ  MAIN", "ðŸŒ¾ FARM", "ðŸŽ° GACHA", "âš¡ STATS",Â  [cite: 70]
Â  Â  "ðŸš€ TELEPORT", "ðŸ¥š OPEN EGG", "ðŸ° DUNGEON", "ðŸ’¾ CONFIG", "âš™ï¸ SETTINGS" [cite: 70]
}
local tabFrames, tabButtons = {}, {}

for i, tabName in pairs(tabs) do
Â  Â  local tabButton = Instance.new("TextButton")
Â  Â  tabButton.Size = UDim2.new(0, 120, 1, 0) [cite: 70]
Â  Â  tabButton.BackgroundColor3 = i == 1 and ColorTheme.Accent or Color3.fromRGB(40, 40, 50) [cite: 70, 72]
Â  Â  tabButton.Text = tabName [cite: 70]
Â  Â  tabButton.TextColor3 = ColorTheme.Text [cite: 70]
Â  Â  tabButton.Font = Enum.Font.GothamBold [cite: 70]
Â  Â  tabButton.TextSize = 12 [cite: 70]
Â  Â  tabButton.Parent = TabContainer [cite: 70]

Â  Â  local tabButtonCorner = Instance.new("UICorner")
Â  Â  tabButtonCorner.CornerRadius = UDim.new(0.1, 0)
Â  Â  tabButtonCorner.Parent = tabButton

Â  Â  local contentFrame = Instance.new("ScrollingFrame")
Â  Â  contentFrame.Size = UDim2.new(1, 0, 1, 0) [cite: 71]
Â  Â  contentFrame.BackgroundTransparency = 1 [cite: 71]
Â  Â  contentFrame.ScrollBarThickness = 5 [cite: 71]
Â  Â  contentFrame.ScrollBarImageColor3 = ColorTheme.Accent [cite: 71]
Â  Â  contentFrame.CanvasSize = UDim2.new(0, 0, 2, 0) [cite: 71]
Â  Â  contentFrame.Visible = i == 1 [cite: 71]
Â  Â  contentFrame.Parent = ContentScroll [cite: 71]

Â  Â  local contentFrameLayout = Instance.new("UIListLayout")
Â  Â  contentFrameLayout.Padding = UDim.new(0, 10)
Â  Â  contentFrameLayout.Parent = contentFrame

Â  Â  tabFrames[tabName] = contentFrame
Â  Â  tabButtons[tabName] = tabButton

Â  Â  SafeConnect(tabButton.MouseButton1Click, function()
Â  Â  Â  Â  for name, frame in pairs(tabFrames) do
Â  Â  Â  Â  Â  Â  frame.Visible = (name == tabName)
Â  Â  Â  Â  end
Â  Â  Â  Â  for name, btn in pairs(tabButtons) do
Â  Â  Â  Â  Â  Â  btn.BackgroundColor3 = (name == tabName) and ColorTheme.Accent or Color3.fromRGB(40, 40, 50) [cite: 72]
Â  Â  Â  Â  end
Â  Â  end)
end

-- NEW: HÃ m cáº­p nháº­t toggle button
local function UpdateToggleButton(toggleFrame, enabled)
Â  Â  local toggleBtn = toggleFrame:FindFirstChildOfClass("TextButton")
Â  Â  if toggleBtn then
Â  Â  Â  Â  toggleBtn.Text = enabled and "ON" or "OFF"
Â  Â  Â  Â  toggleBtn.BackgroundColor3 = enabled and ColorTheme.Success or ColorTheme.Danger
Â  Â  end
end

function CreateToggleSwitch(text, description, default, callback)
Â  Â  local frame = Instance.new("Frame")
Â  Â  frame.Size = UDim2.new(1, 0, 0, 60)
Â  Â  frame.BackgroundTransparency = 1
Â  Â  frame.Name = "Toggle_" .. text:gsub("%s+", "") -- TÃªn frame Ä‘á»ƒ dá»… tÃ¬m kiáº¿m

Â  Â  local bg = Instance.new("Frame")
Â  Â  bg.Size = UDim2.new(1, 0, 0, 50) [cite: 73]
Â  Â  bg.BackgroundColor3 = Color3.fromRGB(30, 30, 40) [cite: 73]
Â  Â  bg.Parent = frame [cite: 73]

Â  Â  local bgCorner = Instance.new("UICorner")
Â  Â  bgCorner.CornerRadius = UDim.new(0.1, 0)
Â  Â  bgCorner.Parent = bg

Â  Â  local label = Instance.new("TextLabel")
Â  Â  label.Size = UDim2.new(0.7, 0, 0.5, 0) [cite: 73]
Â  Â  label.Position = UDim2.new(0, 15, 0, 5) [cite: 73]
Â  Â  label.BackgroundTransparency = 1 [cite: 73]
Â  Â  label.Text = text [cite: 73]
Â  Â  label.TextColor3 = ColorTheme.Text [cite: 73]
Â  Â  label.Font = Enum.Font.GothamBold [cite: 73]
Â  Â  label.TextSize = 14 [cite: 73]
Â  Â  label.TextXAlignment = Enum.TextXAlignment.Left [cite: 73]
Â  Â  label.Parent = frame [cite: 73]

Â  Â  local desc = Instance.new("TextLabel")
Â  Â  desc.Size = UDim2.new(0.7, 0, 0.5, 0) [cite: 74]
Â  Â  desc.Position = UDim2.new(0, 15, 0.5, 0) [cite: 74]
Â  Â  desc.BackgroundTransparency = 1 [cite: 74]
Â  Â  desc.Text = description [cite: 74]
Â  Â  desc.TextColor3 = ColorTheme.TextSecondary [cite: 74]
Â  Â  desc.Font = Enum.Font.Gotham [cite: 74]
Â  Â  desc.TextSize = 11 [cite: 74]
Â  Â  desc.TextXAlignment = Enum.TextXAlignment.Left [cite: 74]
Â  Â  desc.Parent = frame [cite: 74]

Â  Â Â 
Â  Â  local toggle = Instance.new("TextButton")
Â  Â  toggle.Size = UDim2.new(0, 50, 0, 26) [cite: 74]
Â  Â  toggle.Position = UDim2.new(1, -65, 0.5, -13) [cite: 74]
Â  Â  toggle.BackgroundColor3 = default and ColorTheme.Success or ColorTheme.Danger [cite: 74]
Â  Â  toggle.Text = default and "ON" or "OFF" [cite: 74]
Â  Â  toggle.TextColor3 = ColorTheme.Text [cite: 74]
Â  Â  toggle.Font = Enum.Font.GothamBold [cite: 74]
Â  Â  toggle.TextSize = 12 [cite: 74]
Â  Â  toggle.Parent = frame [cite: 74]

Â  Â  local toggleCorner = Instance.new("UICorner")
Â  Â  toggleCorner.CornerRadius = UDim.new(0.5, 0)
Â  Â  toggleCorner.Parent = toggle

Â  Â  local toggled = default
Â  Â  toggle.MouseButton1Click:Connect(function()
Â  Â  Â  Â  toggled = not toggled
Â  Â  Â  Â  UpdateToggleButton(frame, toggled) [cite: 75]
Â  Â  Â  Â  if callback then callback(toggled) end
Â  Â  end)

Â  Â  return frame
end

function CreateActionButton(text, description, callback)
Â  Â  local frame = Instance.new("Frame")
Â  Â  frame.Size = UDim2.new(1, 0, 0, 60)
Â  Â  frame.BackgroundTransparency = 1

Â  Â  local btn = Instance.new("TextButton")
Â  Â  btn.Size = UDim2.new(0.5, 0, 0, 40) [cite: 75]
Â  Â  btn.Position = UDim2.new(0, 10, 0, 10) [cite: 75]
Â  Â  btn.BackgroundColor3 = ColorTheme.Accent [cite: 75]
Â  Â  btn.Text = text [cite: 75]
Â  Â  btn.TextColor3 = ColorTheme.Text [cite: 75]
Â  Â  btn.Font = Enum.Font.GothamBold [cite: 75]
Â  Â  btn.TextSize = 13 [cite: 75]
Â  Â  btn.Parent = frame [cite: 75]

Â  Â  local btnCorner = Instance.new("UICorner")
Â  Â  btnCorner.CornerRadius = UDim.new(0.1, 0)
Â  Â  btnCorner.Parent = btn

Â  Â  local btnStroke = Instance.new("UIStroke")
Â  Â  btnStroke.Color = Color3.fromRGB(100, 150, 255) [cite: 76]
Â  Â  btnStroke.Thickness = 1 [cite: 76]
Â  Â  btnStroke.Parent = btn [cite: 76]

Â  Â  local desc = Instance.new("TextLabel")
Â  Â  desc.Size = UDim2.new(0.5, 0, 0, 20) [cite: 76]
Â  Â  desc.Position = UDim2.new(0.5, 20, 0, 20) [cite: 76]
Â  Â  desc.BackgroundTransparency = 1 [cite: 76]
Â  Â  desc.Text = description [cite: 76]
Â  Â  desc.TextColor3 = ColorTheme.TextSecondary [cite: 76]
Â  Â  desc.Font = Enum.Font.Gotham [cite: 76]
Â  Â  desc.TextSize = 11 [cite: 76]
Â  Â  desc.TextXAlignment = Enum.TextXAlignment.Left [cite: 76]
Â  Â  desc.Parent = frame [cite: 76]

Â  Â  -- Hover effect
Â  Â  SafeConnect(btn.MouseEnter, function()
Â  Â  Â  Â  TweenService:Create(btn, TweenInfo.new(0.2), {BackgroundColor3 = ColorTheme.AccentHover}):Play()
Â  Â  end)

Â  Â  SafeConnect(btn.MouseLeave, function()
Â  Â  Â  Â  TweenService:Create(btn, TweenInfo.new(0.2), {BackgroundColor3 = ColorTheme.Accent}):Play()
Â  Â  end)

Â  Â  btn.MouseButton1Click:Connect(function()
Â  Â  Â  Â  if callback then callback() end [cite: 77]
Â  Â  end)

Â  Â  return frame
end

function CreateComboBox(text, description, items, callback)
Â  Â  local frame = Instance.new("Frame")
Â  Â  frame.Size = UDim2.new(1, 0, 0, 70) [cite: 77]
Â  Â  frame.BackgroundTransparency = 1 [cite: 77]

Â  Â  local bg = Instance.new("Frame")
Â  Â  bg.Size = UDim2.new(1, 0, 0, 60) [cite: 77]
Â  Â  bg.BackgroundColor3 = Color3.fromRGB(30, 30, 40) [cite: 77]
Â  Â  bg.Parent = frame [cite: 77]

Â  Â  local bgCorner = Instance.new("UICorner")
Â  Â  bgCorner.CornerRadius = UDim.new(0.1, 0)
Â  Â  bgCorner.Parent = bg

Â  Â  local label = Instance.new("TextLabel")
Â  Â  label.Size = UDim2.new(0.5, 0, 0.5, 0) [cite: 78]
Â  Â  label.Position = UDim2.new(0, 15, 0, 5) [cite: 78]
Â  Â  label.BackgroundTransparency = 1 [cite: 78]
Â  Â  label.Text = text [cite: 78]
Â  Â  label.TextColor3 = ColorTheme.Text [cite: 78]
Â  Â  label.Font = Enum.Font.GothamBold [cite: 78]
Â  Â  label.TextSize = 14 [cite: 78]
Â  Â  label.TextXAlignment = Enum.TextXAlignment.Left [cite: 78]
Â  Â  label.Parent = frame [cite: 78]

Â  Â  local desc = Instance.new("TextLabel")
Â  Â  desc.Size = UDim2.new(0.5, 0, 0.5, 0) [cite: 78]
Â  Â  desc.Position = UDim2.new(0, 15, 0.5, 0) [cite: 78]
Â  Â  desc.BackgroundTransparency = 1 [cite: 78]
Â  Â  desc.Text = description [cite: 78]
Â  Â  desc.TextColor3 = ColorTheme.TextSecondary [cite: 78]
Â  Â Â 
Â  Â  desc.Font = Enum.Font.Gotham [cite: 78]
Â  Â  desc.TextSize = 11 [cite: 78]
Â  Â  desc.TextXAlignment = Enum.TextXAlignment.Left [cite: 78]
Â  Â  desc.Parent = frame [cite: 78]

Â  Â  local dropdown = Instance.new("TextButton")
Â  Â  dropdown.Size = UDim2.new(0.4, 0, 0, 35) [cite: 79]
Â  Â  dropdown.Position = UDim2.new(0.55, 0, 0.2, 0) [cite: 79]
Â  Â  dropdown.BackgroundColor3 = ColorTheme.Accent [cite: 79]
Â  Â  dropdown.Text = items[1] or "Select" [cite: 79]
Â  Â  dropdown.TextColor3 = ColorTheme.Text [cite: 79]
Â  Â  dropdown.Font = Enum.Font.GothamBold [cite: 79]
Â  Â  dropdown.TextSize = 13 [cite: 79]
Â  Â  dropdown.Parent = frame [cite: 79]

Â  Â  local btnCorner = Instance.new("UICorner")
Â  Â  btnCorner.CornerRadius = UDim.new(0.1, 0) [cite: 79]
Â  Â  btnCorner.Parent = dropdown [cite: 79]

Â  Â  local selected = items[1]
Â  Â  local menu = nil
Â  Â Â 
Â  Â  local function CloseMenu()
Â  Â  Â  Â  if menu then
Â  Â  Â  Â  Â  Â  menu:Destroy()
Â  Â  Â  Â  Â  Â  menu = nil
Â  Â  Â  Â  end
Â  Â  end
Â  Â Â 
Â  Â  dropdown.MouseButton1Click:Connect(function()
Â  Â  Â  Â  if menu then
Â  Â  Â  Â  Â  Â  CloseMenu()
Â  Â  Â  Â  Â  Â  return
Â  Â  Â  Â  end
Â  Â  Â  Â Â 
Â  Â  Â  Â  menu = Instance.new("Frame")
Â  Â  Â  Â  menu.Size = UDim2.new(0.4, 0, 0, #items * 35) [cite: 80]
Â  Â  Â  Â  menu.Position = UDim2.new(0.55, 0, 0.8, 0) [cite: 80]
Â  Â  Â  Â  menu.BackgroundColor3 = Color3.fromRGB(40, 40, 50) [cite: 80]
Â  Â  Â  Â  menu.Parent = frame [cite: 80]
Â  Â  Â  Â Â 
Â  Â  Â  Â  local menuCorner = Instance.new("UICorner")
Â  Â  Â  Â  menuCorner.CornerRadius = UDim.new(0.1, 0)
Â  Â  Â  Â  menuCorner.Parent = menu

Â  Â  Â  Â  local menuStroke = Instance.new("UIStroke")
Â  Â  Â  Â  menuStroke.Color = ColorTheme.Accent
Â  Â  Â  Â  menuStroke.Thickness = 1
Â  Â  Â  Â  menuStroke.Parent = menu

Â  Â  Â  Â  for i, item in ipairs(items) do
Â  Â  Â  Â  Â  Â  local itemBtn = Instance.new("TextButton")
Â  Â  Â  Â  Â  Â  itemBtn.Size = UDim2.new(1, 0, 0, 35) [cite: 81]
Â  Â  Â  Â  Â  Â  itemBtn.Position = UDim2.new(0, 0, 0, (i-1)*35) [cite: 81]
Â  Â  Â  Â  Â  Â  itemBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 60) [cite: 81]
Â  Â  Â  Â  Â  Â  itemBtn.Text = item [cite: 81]
Â  Â  Â  Â  Â  Â  itemBtn.TextColor3 = ColorTheme.Text [cite: 81]
Â  Â Â 
Â  Â  Â  Â  Â  Â  itemBtn.Font = Enum.Font.Gotham [cite: 81]
Â  Â  Â  Â  Â  Â  itemBtn.TextSize = 12 [cite: 81]
Â  Â  Â  Â  Â  Â  itemBtn.Parent = menu [cite: 81]
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  local itemCorner = Instance.new("UICorner")
Â  Â  Â  Â  Â  Â  itemCorner.CornerRadius = UDim.new(0, 0)
Â  Â  Â  Â  Â  Â  itemCorner.Parent = itemBtn
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  itemBtn.MouseButton1Click:Connect(function() [cite: 82]
Â  Â  Â  Â  Â  Â  Â  Â  dropdown.Text = item
Â  Â  Â  Â  Â  Â  Â  Â  selected = item
Â  Â  Â  Â  Â  Â  Â  Â  CloseMenu()
Â  Â  Â  Â  Â  Â  Â  Â  if callback then callback(item) end
Â  Â  Â  Â  Â  Â  end)
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  -- Hover effect
Â  Â  Â  Â  Â  Â  SafeConnect(itemBtn.MouseEnter, function()
Â  Â  Â  Â  Â  Â  Â  Â  TweenService:Create(itemBtn, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(60, 60, 70)}):Play()
Â  Â  Â  Â  Â  Â  end)
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  SafeConnect(itemBtn.MouseLeave, function() [cite: 83]
Â  Â  Â  Â  Â  Â  Â  Â  TweenService:Create(itemBtn, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(50, 50, 60)}):Play()
Â  Â  Â  Â  Â  Â  end)
Â  Â  Â  Â  end
Â  Â  end)
Â  Â Â 
Â  Â  -- Close menu khi click outside
Â  Â  SafeConnect(UserInputService.InputBegan, function(input)
Â  Â  Â  Â  if input.UserInputType == Enum.UserInputType.MouseButton1 and menu then
Â  Â  Â  Â  Â  Â  local mousePos = UserInputService:GetMouseLocation()
Â  Â  Â  Â  Â  Â  local menuPos = menu.AbsolutePosition
Â  Â  Â  Â  Â  Â  local menuSize = menu.AbsoluteSize
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  if mousePos.X < menuPos.X or mousePos.X > menuPos.X + menuSize.X or [cite: 84]
Â  Â  Â  Â  Â  Â  Â  Â mousePos.Y < menuPos.Y or mousePos.Y > menuPos.Y + menuSize.Y then
Â  Â  Â  Â  Â  Â  Â  Â  CloseMenu()
Â  Â  Â  Â  Â  Â  end
Â  Â  Â  Â  end
Â  Â  end)

Â  Â  return frame
end

-- MAIN TAB
local mainContent = tabFrames["ðŸ  MAIN"]
local mainStatus = Instance.new("TextLabel")
mainStatus.Size = UDim2.new(1, -20, 0, 40)
mainStatus.BackgroundTransparency = 1
mainStatus.Text = "âš¡ DARK EDITION - Táº¥t cáº£ tÃ­nh nÄƒng Ä‘Ã£ sáºµn sÃ ng!" [cite: 85]
mainStatus.TextColor3 = ColorTheme.Text [cite: 85]
mainStatus.Font = Enum.Font.Gotham [cite: 85]
mainStatus.TextSize = 14 [cite: 85]
mainStatus.Parent = mainContent [cite: 85]

-- Biáº¿n lÆ°u cÃ¡c toggle
local autoAttackToggleFrame, autoFarmSelectedToggleFrame, autoFarmRandomToggleFrame, autoDropsToggleFrame
local stealthToggleFrame, antiAfkToggleFrame, autoOpenEggToggleFrame, dungeonToggleFrame, raidFarmToggleFrame
local autoJoinDungeonToggleFrame, autoJoinRaidToggleFrame, autoHatchEggToggleFrame, autoRankUpToggleFrame -- ÄÃ£ thÃªm
local autoStatToggleFrameÂ 
local autoExitDungeonToggleFrame, autoExitRaidToggleFrameÂ 

autoAttackToggleFrame = CreateToggleSwitch("Enable Auto Attack", "Tá»± Ä‘á»™ng táº¥n cÃ´ng káº» Ä‘á»‹ch gáº§n nháº¥t", false, function(enabled)
Â  Â  autoAttackEnabled = enabled
Â  Â  if enabled then StartLoop("AutoAttack", AutoAttackLogic, 0.3) else StopLoop("AutoAttack") end
end)
autoAttackToggleFrame.Parent = mainContent

autoDropsToggleFrame = CreateToggleSwitch("Enable Auto Collect All Drops", "Tá»± Ä‘á»™ng nháº·t váº­t pháº©m quanh báº¡n", false, function(enabled)
Â  Â  autoCollectEnabled = enabled
Â  Â  if enabled then StartLoop("AutoCollect", AutoCollectLogic, 1.0) else StopLoop("AutoCollect") end
end)
autoDropsToggleFrame.Parent = mainContent

autoRankUpToggleFrame = CreateToggleSwitch("Enable Auto Rank UP", "Tá»± Ä‘á»™ng thÄƒng háº¡ng nhÃ¢n váº­t (RankUp)", false, function(enabled) [cite: 86]
Â  Â  autoRankUpEnabled = enabled
Â  Â  if enabled then StartLoop("AutoRankUp", AutoRankUpLogic, 5.0) else StopLoop("AutoRankUp") end
end)
autoRankUpToggleFrame.Parent = mainContent

-- FARM TAB
local farmContent = tabFrames["ðŸŒ¾ FARM"]

autoFarmSelectedToggleFrame = CreateToggleSwitch("Enable Auto Farm Selected Enemies", "Tá»± Ä‘á»™ng farm Táº¤T Cáº¢ enemy cÃ¹ng tÃªn (SPEED: 0.1s)", false, function(enabled)
Â  Â  selectedFarmEnabled = enabled
Â  Â  if enabled then StartLoop("FarmSelected", FarmSelectedLogic, 0.1) else StopLoop("FarmSelected") end
end)
autoFarmSelectedToggleFrame.Parent = farmContent

autoFarmRandomToggleFrame = CreateToggleSwitch("Enable Farm Random Enemies", "Tá»± Ä‘á»™ng farm ngáº«u nhiÃªn", false, function(enabled)
Â  Â  farmRandomEnabled = enabled
Â  Â  if enabled then StartLoop("FarmRandom", FarmRandomLogic, 0.5) else StopLoop("FarmRandom") end
end)
autoFarmRandomToggleFrame.Parent = farmContent

local refreshGroupsBtn = CreateActionButton("Refresh Enemy Groups", "QuÃ©t vÃ  hiá»ƒn thá»‹ enemy theo nhÃ³m", function() [cite: 87]
Â  Â  for _, child in pairs(farmContent:GetChildren()) do
Â  Â  Â  Â  if child:IsA("Frame") and string.find(child.Name or "", "GroupFrame") then
Â  Â  Â  Â  Â  Â  child:Destroy()
Â  Â  Â  Â  end
Â  Â  end

Â  Â  local enemyGroups = GetEnemyGroups()
Â  Â Â 
Â  Â  for enemyName, group in pairs(enemyGroups) do
Â  Â  Â  Â  local groupFrame = Instance.new("Frame")
Â  Â  Â  Â  groupFrame.Name = "GroupFrame_" .. enemyName [cite: 87]
Â  Â  Â  Â  groupFrame.Size = UDim2.new(1, 0, 0, 70) [cite: 87]
Â  Â  Â  Â  groupFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 50) [cite: 87]
Â  Â  Â  Â  groupFrame.Parent = farmContent [cite: 87]

Â  Â  Â  Â  local cornerRadius = Instance.new("UICorner")
Â  Â  Â  Â  cornerRadius.CornerRadius = UDim.new(0.1, 0)
Â  Â  Â  Â  cornerRadius.Parent = groupFrame [cite: 88]

Â  Â  Â  Â  local nameLabel = Instance.new("TextLabel")
Â  Â  Â  Â  nameLabel.Size = UDim2.new(0.6, 0, 0.5, 0) [cite: 88]
Â  Â  Â  Â  nameLabel.Position = UDim2.new(0, 15, 0, 5) [cite: 88]
Â  Â  Â  Â  nameLabel.BackgroundTransparency = 1 [cite: 88]
Â  Â  Â  Â  nameLabel.Text = "ðŸ‘¹ " .. enemyName [cite: 88]
Â  Â  Â  Â  nameLabel.TextColor3 = ColorTheme.Text [cite: 88]
Â  Â  Â  Â  nameLabel.Font = Enum.Font.GothamBold [cite: 88]
Â  Â  Â  Â  nameLabel.TextSize = 14 [cite: 88]
Â  Â  Â  Â  nameLabel.TextXAlignment = Enum.TextXAlignment.Left [cite: 88]
Â  Â  Â  Â  nameLabel.Parent = groupFrame [cite: 88]

Â  Â  Â  Â  local infoLabel = Instance.new("TextLabel")
Â  Â  Â  Â  infoLabel.Size = UDim2.new(0.6, 0, 0.5, 0) [cite: 89]
Â  Â  Â  Â  infoLabel.Position = UDim2.new(0, 15, 0.5, 0) [cite: 89]
Â  Â  Â  Â  infoLabel.BackgroundTransparency = 1 [cite: 89]
Â  Â  Â  Â  infoLabel.Text = "ðŸ“Š Sá»‘ lÆ°á»£ng: " .. group.count .. " | Khoáº£ng cÃ¡ch: " .. math.floor(group.nearestDistance) .. "m" [cite: 90]
Â  Â  Â  Â  infoLabel.TextColor3 = ColorTheme.TextSecondary [cite: 90]
Â  Â  Â  Â  infoLabel.Font = Enum.Font.Gotham [cite: 90]
Â  Â  Â  Â  infoLabel.TextSize = 11 [cite: 90]
Â  Â  Â  Â  infoLabel.TextXAlignment = Enum.TextXAlignment.Left [cite: 90]
Â  Â  Â  Â  infoLabel.Parent = groupFrame [cite: 90]

Â  Â  Â  Â  local selectBtn = Instance.new("TextButton")
Â  Â  Â  Â  selectBtn.Size = UDim2.new(0.3, 0, 0, 30) [cite: 90]
Â  Â  Â  Â  selectBtn.Position = UDim2.new(0.65, 0, 0.2, 0) [cite: 90]
Â  Â  Â  Â  selectBtn.BackgroundColor3 = ColorTheme.Accent [cite: 90]
Â  Â  Â  Â  selectBtn.Text = "ðŸŽ¯ CHá»ŒN NHÃ“M" [cite: 90]
Â  Â  Â  Â  selectBtn.TextColor3 = ColorTheme.Text [cite: 90]
Â  Â  Â  Â  selectBtn.Font = Enum.Font.GothamBold [cite: 90]
Â  Â  Â  Â  selectBtn.TextSize = 11 [cite: 90]
Â  Â  Â  Â  selectBtn.Parent = groupFrame [cite: 90]

Â  Â  Â  Â  local selectCorner = Instance.new("UICorner")
Â  Â  Â  Â  selectCorner.CornerRadius = UDim.new(0.1, 0) [cite: 91]
Â  Â  Â  Â  selectCorner.Parent = selectBtn [cite: 91]

Â  Â  Â  Â  local isSelected = false
Â  Â  Â  Â  for _, selectedName in ipairs(selectedEnemyNames) do
Â  Â  Â  Â  Â  Â  if selectedName == enemyName then
Â  Â  Â  Â  Â  Â  Â  Â  isSelected = true
Â  Â  Â  Â  Â  Â  Â  Â  break
Â  Â  Â  Â  Â  Â  end
Â  Â  Â  Â  end

Â  Â  Â  Â  if isSelected then
Â  Â  Â  Â  Â  Â  selectBtn.BackgroundColor3 = ColorTheme.Success
Â  Â  Â  Â  Â  Â  selectBtn.Text = "âœ… ÄÃƒ CHá»ŒN" [cite: 92]
Â  Â  Â  Â  end

Â  Â  Â  Â  selectBtn.MouseButton1Click:Connect(function()
Â  Â  Â  Â  Â  Â  isSelected = not isSelected
Â  Â  Â  Â  Â  Â  if isSelected then
Â  Â  Â  Â  Â  Â  Â  Â  selectBtn.BackgroundColor3 = ColorTheme.Success [cite: 92]
Â  Â  Â  Â  Â  Â  Â  Â  selectBtn.Text = "âœ… ÄÃƒ CHá»ŒN" [cite: 92]
Â  Â  Â  Â  Â  Â  Â  Â  local found = false
Â  Â  Â  Â  Â  Â  Â  Â  for _, name in ipairs(selectedEnemyNames) do
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if name == enemyName then found = true; break end [cite: 93]
Â  Â  Â  Â  Â  Â  Â  Â  end
Â  Â  Â  Â  Â  Â  Â  Â  if not found then
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  table.insert(selectedEnemyNames, enemyName) [cite: 93]
Â  Â  Â  Â  Â  Â  Â  Â  end
Â  Â  Â  Â  Â  Â  else
Â  Â  Â  Â  Â  Â  Â  Â  selectBtn.BackgroundColor3 = ColorTheme.Accent [cite: 94]
Â  Â  Â  Â  Â  Â  Â  Â  selectBtn.Text = "ðŸŽ¯ CHá»ŒN NHÃ“M" [cite: 94]
Â  Â  Â  Â  Â  Â  Â  Â  for i, name in ipairs(selectedEnemyNames) do
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if name == enemyName then
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  table.remove(selectedEnemyNames, i) [cite: 94]
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  end
Â  Â  Â  Â  Â  Â  Â  Â  end
Â  Â  Â  Â  Â  Â  end
Â  Â  Â  Â  end)
Â  Â  end
end)
refreshGroupsBtn.Parent = farmContent

local clearFarmBtn = CreateActionButton("Clear Farm List", "XÃ³a danh sÃ¡ch enemy Ä‘Æ°á»£c chá»n", function()
Â  Â  selectedEnemyNames = {}
Â  Â  refreshGroupsBtn.MouseButton1Click:Fire()
end)
clearFarmBtn.Parent = farmContent

local showSelectedBtn = CreateActionButton("Show Selected Groups", "Hiá»ƒn thá»‹ cÃ¡c nhÃ³m Ä‘Ã£ chá»n", function()
Â  Â  if #selectedEnemyNames == 0 then
Â  Â  Â  Â  mainStatus.Text = "ðŸ“­ ChÆ°a chá»n nhÃ³m enemy nÃ o!" [cite: 95]
Â  Â  else
Â  Â  Â  Â  mainStatus.Text = "ðŸ“‹ Äang farm " .. #selectedEnemyNames .. " nhÃ³m: " .. table.concat(selectedEnemyNames, ", ")
Â  Â  end
end)
showSelectedBtn.Parent = farmContent

-- GACHA TAB
local gachaContent = tabFrames["ðŸŽ° GACHA"]
local gachaTypes = {"Biju", "Sayajin", "Race", "Haki", "Fruits"}
local gachaCombo = CreateComboBox("Gacha Type", "Chá»n loáº¡i gacha Ä‘á»ƒ roll", gachaTypes, function(selected)
Â  Â  selectedGachaType = selected
end)
gachaCombo.Parent = gachaContent

for _, gacha in ipairs(gachaTypes) do
Â  Â  local toggle = CreateToggleSwitch("Enable Auto Roll " .. gacha, "Tá»± Ä‘á»™ng roll " .. gacha, false, function(enabled)
Â  Â  Â  Â  local currentLoopName = "AutoRoll"..gacha [cite: 96]
Â  Â  Â  Â  if enabled then
Â  Â  Â  Â  Â  Â  for _, typeName in ipairs(gachaTypes) do [cite: 96]
Â  Â  Â  Â  Â  Â  Â  Â  Â if typeName ~= gacha then StopLoop("AutoRoll"..typeName) end [cite: 96]
Â  Â  Â  Â  Â  Â  end
Â  Â  Â  Â  Â  Â  selectedGachaType = gacha [cite: 96]
Â  Â  Â  Â  Â  Â  StartLoop(currentLoopName, function() StartGacha(gacha) end, 2) [cite: 96]
Â  Â  Â  Â  else
Â  Â  Â  Â  Â  Â  StopLoop(currentLoopName) [cite: 96]
Â  Â  Â  Â  end
Â  Â  end)
Â  Â  toggle.Parent = gachaContent
end

-- STATS TAB
local statsContent = tabFrames["âš¡ STATS"]
local statTypes = {"Mastery", "Damage", "Luck", "Yen"}Â 
local statCombo = CreateComboBox("Stat Type", "Chá»n loáº¡i stat Ä‘á»ƒ cá»™ng", statTypes, function(selected)
Â  Â  selectedStat = selected
end)
statCombo.Parent = statsContent

autoStatToggleFrame = CreateToggleSwitch("Enable Auto Stat", "Tá»± Ä‘á»™ng cá»™ng Ä‘iá»ƒm stat Ä‘Ã£ chá»n", false, function(enabled) [cite: 97]
Â  Â  autoStatEnabled = enabled [cite: 97]
Â  Â  if enabled thenÂ 
Â  Â  Â  Â  StartLoop("AutoStat", AutoStatLogic, 1) [cite: 97]
Â  Â  else
Â  Â  Â  Â  StopLoop("AutoStat") [cite: 97]
Â  Â  end
end)
autoStatToggleFrame.Parent = statsContent

local distributeBtn = CreateActionButton("Distribute Stat Point", "Cá»™ng Ä‘iá»ƒm stat Ä‘Ã£ chá»n", function()
Â  Â  DistributeStat(selectedStat)
end)
distributeBtn.Parent = statsContent

-- TELEPORT TAB
local teleportContent = tabFrames["ðŸš€ TELEPORT"]
local zoneList = {"Dungeon", "Naruto", "DragonBall", "OnePiece", "DemonSlayer"}Â 
local zoneCombo = CreateComboBox("Zone", "Chá»n khu vá»±c Ä‘á»ƒ teleport", zoneList, function(selected)
Â  Â  selectedZone = selected
end)
zoneCombo.Parent = teleportContent

local teleportBtn = CreateActionButton("Teleport", "Di chuyá»ƒn Ä‘áº¿n khu vá»±c Ä‘Ã£ chá»n", function()
Â  Â  TeleportToZone(selectedZone)
end)
teleportBtn.Parent = teleportContent

-- OPEN EGG TAB - ÄÆ N GIáº¢N HÃ“A
local eggContent = tabFrames["ðŸ¥š OPEN EGG"]

-- Chá»‰ giá»¯ láº¡i 1 toggle duy nháº¥t [cite: 98]
autoHatchEggToggleFrame = CreateToggleSwitch("Enable Auto Hatch Egg", "Tá»± Ä‘á»™ng hatch egg liÃªn tá»¥c", false, function(enabled) [cite: 98]
Â  Â  autoHatchEggEnabled = enabled [cite: 98]
Â  Â  if enabled then
Â  Â  Â  Â  StartLoop("AutoHatchEgg", AutoHatchEggLogic, 0.5) [cite: 98]
Â  Â  else
Â  Â  Â  Â  StopLoop("AutoHatchEgg") [cite: 98]
Â  Â  end
end)
autoHatchEggToggleFrame.Parent = eggContent

-- DUNGEON TAB (REBUILT UI)
local dungeonContent = tabFrames["ðŸ° DUNGEON"]

-- Dungeon Mode
local dungeonModeCombo = CreateComboBox("Dungeon Mode", "Chá»n cháº¿ Ä‘á»™ dungeon", {"Easy", "Medium", "Hard"}, function(selected)
Â  Â  selectedDungeonMode = selected
end)
dungeonModeCombo.Parent = dungeonContent

local joinDungeonBtn = CreateActionButton("Join Dungeon", "Tham gia dungeon Ä‘Ã£ chá»n", function()
Â  Â  JoinDungeon(selectedDungeonMode)
end)
joinDungeonBtn.Parent = dungeonContent

-- Dungeon Exit Settings (Grouped)
autoExitDungeonToggleFrame = CreateToggleSwitch("Enable Auto Exit Dungeon", "ThoÃ¡t dungeon khi Ä‘áº¡t Room/Wave Ä‘Ã£ Ä‘áº·t", false, function(enabled) [cite: 99]
Â  Â  autoExitDungeonEnabled = enabled [cite: 99]
end)
autoExitDungeonToggleFrame.Parent = dungeonContent

local dungeonExitText = Instance.new("TextLabel")
dungeonExitText.Size = UDim2.new(0.5, 0, 0, 20)
dungeonExitText.BackgroundTransparency = 1
dungeonExitText.Position = UDim2.new(0, 15, 0, 0)
dungeonExitText.Text = "Nháº­p Exit Wave/Room (Dungeon):"
dungeonExitText.TextColor3 = ColorTheme.TextSecondary
dungeonExitText.Font = Enum.Font.Gotham
dungeonExitText.TextSize = 11
dungeonExitText.TextXAlignment = Enum.TextXAlignment.Left
dungeonExitText.Parent = dungeonContent

local dungeonExitInput = Instance.new("TextBox")
dungeonExitInput.Name = "DungeonExitInput"
dungeonExitInput.Size = UDim2.new(0.4, 0, 0, 30)
dungeonExitInput.Position = UDim2.new(0, 10, 0, 0)
dungeonExitInput.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
dungeonExitInput.TextColor3 = ColorTheme.Text
dungeonExitInput.PlaceholderText = "0 (Táº¯t)"
dungeonExitInput.PlaceholderColor3 = ColorTheme.TextSecondary
dungeonExitInput.Text = tostring(exitDungeonWaveNumber)
dungeonExitInput.Font = Enum.Font.Gotham
dungeonExitInput.TextSize = 12
dungeonExitInput.Parent = dungeonContent
Instance.new("UICorner", dungeonExitInput).CornerRadius = UDim.new(0.1, 0)

SafeConnect(dungeonExitInput.FocusLost, function(enterPressed)
Â  Â  if enterPressed then
Â  Â  Â  Â  local num = tonumber(dungeonExitInput.Text)
Â  Â  Â  Â  if num and num >= 0 then
Â  Â  Â  Â  Â  Â  exitDungeonWaveNumber = math.floor(num) [cite: 100]
Â  Â  Â  Â  Â  Â  mainStatus.Text = "ðŸ“ ÄÃ£ Ä‘áº·t Auto Exit Dungeon táº¡i Wave/Room: " .. exitDungeonWaveNumber [cite: 100]
Â  Â  Â  Â  else
Â  Â  Â  Â  Â  Â  mainStatus.Text = "âŒ Vui lÃ²ng nháº­p sá»‘ Wave/Room há»£p lá»‡ (>=0) cho Dungeon." [cite: 100]
Â  Â  Â  Â  Â  Â  dungeonExitInput.Text = tostring(exitDungeonWaveNumber) [cite: 100]
Â  Â  Â  Â  end
Â  Â  end
end)

dungeonToggleFrame = CreateToggleSwitch("Enable Auto Farm Dungeon", "Tá»± Ä‘á»™ng farm dungeon + tá»± vá» khi xong", false, function(enabled)
Â  Â  autoFarmDungeonEnabled = enabled
Â  Â  if enabled then
Â  Â  Â  Â  if activeLoops["FarmRaid"] then
Â  Â  Â  Â  Â  Â  StopLoop("FarmRaid") [cite: 101]
Â  Â  Â  Â  Â  Â  autoFarmRaidEnabled = false [cite: 101]
            local raidFarmToggle = tabFrames["ðŸ° DUNGEON"]:FindFirstChild("Toggle_EnableAutoFarmRaid")
            if raidFarmToggle then UpdateToggleButton(raidFarmToggle, false) end
Â  Â  Â  Â  end
Â  Â  Â  Â  JoinDungeon(selectedDungeonMode)Â 
Â  Â  else
Â  Â  Â  Â  StopLoop("FarmDungeon")
Â  Â  end
end)
dungeonToggleFrame.Parent = dungeonContent

-- Raid Section
local raidSection = Instance.new("TextLabel")
raidSection.Size = UDim2.new(1, -20, 0, 30)
raidSection.BackgroundTransparency = 1
raidSection.Text = "âš”ï¸ RAID SETTINGS"
raidSection.TextColor3 = ColorTheme.Warning
raidSection.Font = Enum.Font.GothamBold
raidSection.TextSize = 16
raidSection.TextXAlignment = Enum.TextXAlignment.Left
raidSection.Parent = dungeonContent

local joinRaidBtn2 = CreateActionButton("Join Raid", "Tham gia raid", function()
Â  Â  JoinRaid()
end)
joinRaidBtn2.Parent = dungeonContent

-- Raid Exit Settings (Grouped)
autoExitRaidToggleFrame = CreateToggleSwitch("Enable Auto Exit Raid", "ThoÃ¡t raid khi Ä‘áº¡t Room/Wave Ä‘Ã£ Ä‘áº·t", false, function(enabled) [cite: 102]
Â  Â  autoExitRaidEnabled = enabled [cite: 102]
end)
autoExitRaidToggleFrame.Parent = dungeonContent

local raidExitText = Instance.new("TextLabel")
raidExitText.Size = UDim2.new(0.5, 0, 0, 20)
raidExitText.BackgroundTransparency = 1
raidExitText.Position = UDim2.new(0, 15, 0, 0)
raidExitText.Text = "Nháº­p Exit Wave/Room (Raid):"
raidExitText.TextColor3 = ColorTheme.TextSecondary
raidExitText.Font = Enum.Font.Gotham
raidExitText.TextSize = 11
raidExitText.TextXAlignment = Enum.TextXAlignment.Left
raidExitText.Parent = dungeonContent

local raidExitInput = Instance.new("TextBox")
raidExitInput.Name = "RaidExitInput"
raidExitInput.Size = UDim2.new(0.4, 0, 0, 30)
raidExitInput.Position = UDim2.new(0, 10, 0, 0)
raidExitInput.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
raidExitInput.TextColor3 = ColorTheme.Text
raidExitInput.PlaceholderText = "0 (Táº¯t)"
raidExitInput.PlaceholderColor3 = ColorTheme.TextSecondary
raidExitInput.Text = tostring(exitRaidWaveNumber)
raidExitInput.Font = Enum.Font.Gotham
raidExitInput.TextSize = 12
raidExitInput.Parent = dungeonContent
Instance.new("UICorner", raidExitInput).CornerRadius = UDim.new(0.1, 0)

SafeConnect(raidExitInput.FocusLost, function(enterPressed)
Â  Â  if enterPressed then
Â  Â  Â  Â  local num = tonumber(raidExitInput.Text)
Â  Â  Â  Â  if num and num >= 0 then [cite: 103]
Â  Â  Â  Â  Â  Â  exitRaidWaveNumber = math.floor(num) [cite: 103]
Â  Â  Â  Â  Â  Â  mainStatus.Text = "ðŸ“ ÄÃ£ Ä‘áº·t Auto Exit Raid táº¡i Wave/Room: " .. exitRaidWaveNumber [cite: 103]
Â  Â  Â  Â  else
Â  Â  Â  Â  Â  Â  mainStatus.Text = "âŒ Vui lÃ²ng nháº­p sá»‘ Wave/Room há»£p lá»‡ (>=0) cho Raid." [cite: 103]
Â  Â  Â  Â  Â  Â  raidExitInput.Text = tostring(exitRaidWaveNumber) [cite: 103]
Â  Â  Â  Â  end
Â  Â  end
end)

raidFarmToggleFrame = CreateToggleSwitch("Enable Auto Farm Raid", "Tá»± Ä‘á»™ng farm Raid + tá»± vá» khi xong", false, function(enabled)
Â  Â  autoFarmRaidEnabled = enabled
Â  Â  if enabled then
Â  Â  Â  Â  if activeLoops["FarmDungeon"] then [cite: 104]
Â  Â  Â  Â  Â  Â  StopLoop("FarmDungeon") [cite: 104]
Â  Â  Â  Â  Â  Â  autoFarmDungeonEnabled = false [cite: 104]
Â  Â  Â  Â  Â  Â  if dungeonToggleFrame then UpdateToggleButton(dungeonToggleFrame, false) end [cite: 104]
Â  Â  Â  Â  end
Â  Â  Â  Â  JoinRaid()
Â  Â  else
Â  Â  Â  Â  StopLoop("FarmRaid")
Â  Â  end
end)
raidFarmToggleFrame.Parent = dungeonContent

-- Auto Join Section (Grouped at the bottom)
local autoJoinSection = Instance.new("TextLabel")
autoJoinSection.Size = UDim2.new(1, -20, 0, 30)
autoJoinSection.BackgroundTransparency = 1
autoJoinSection.Text = "ðŸŒ AUTO JOIN SETTINGS (5s/láº§n)"
autoJoinSection.TextColor3 = ColorTheme.Accent
autoJoinSection.Font = Enum.Font.GothamBold
autoJoinSection.TextSize = 16
autoJoinSection.TextXAlignment = Enum.TextXAlignment.Left
autoJoinSection.Parent = dungeonContent

autoJoinDungeonToggleFrame = CreateToggleSwitch("Auto-join Dungeon", "Tá»± Ä‘á»™ng join dungeon (Remote Call, 5s)", false, function(enabled)
Â  Â  autoJoinDungeonEnabled = enabled [cite: 105]
Â  Â  if enabled then
Â  Â  Â  Â  StartLoop("AutoJoinDungeon", AutoJoinDungeonLoop, 5)Â  [cite: 105]
Â  Â  else
Â  Â  Â  Â  StopLoop("AutoJoinDungeon") [cite: 105]
Â  Â  end
end)
autoJoinDungeonToggleFrame.Parent = dungeonContent

autoJoinRaidToggleFrame = CreateToggleSwitch("Auto-join Raid", "Tá»± Ä‘á»™ng join raid (Remote Call, 5s)", false, function(enabled)
Â  Â  autoJoinRaidEnabled = enabled
Â  Â  if enabled then
Â  Â  Â  Â  StartLoop("AutoJoinRaid", AutoJoinRaidLoop, 5) [cite: 105]
Â  Â  else
Â  Â  Â  Â  StopLoop("AutoJoinRaid")
Â  Â  end
end)
autoJoinRaidToggleFrame.Parent = dungeonContent

local dungeonStatus = Instance.new("TextLabel")
dungeonStatus.Size = UDim2.new(1, -20, 0, 30)
dungeonStatus.BackgroundTransparency = 1
dungeonStatus.Text = "ðŸ° System: Auto-join vÃ  Auto-exit Ä‘Ã£ sáºµn sÃ ng!" [cite: 106]
dungeonStatus.TextColor3 = ColorTheme.Text [cite: 106]
dungeonStatus.Font = Enum.Font.Gotham [cite: 106]
dungeonStatus.TextSize = 12 [cite: 106]
dungeonStatus.Parent = dungeonContent [cite: 106]

-- CONFIG TAB
local configContent = tabFrames["ðŸ’¾ CONFIG"]

local profileNameInput = Instance.new("TextBox")
profileNameInput.Size = UDim2.new(0.6, 0, 0, 35)
profileNameInput.Position = UDim2.new(0, 10, 0, 10)
profileNameInput.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
profileNameInput.TextColor3 = ColorTheme.Text
profileNameInput.PlaceholderText = "Nháº­p tÃªn Config..."
profileNameInput.PlaceholderColor3 = ColorTheme.TextSecondary
profileNameInput.Text = ""
profileNameInput.Font = Enum.Font.Gotham
profileNameInput.TextSize = 12
profileNameInput.Parent = configContent

local inputCorner = Instance.new("UICorner")
inputCorner.CornerRadius = UDim.new(0.1, 0)
inputCorner.Parent = profileNameInput

-- HÃ m lÃ m má»›i ComboBox config
local function RefreshProfileComboBox()
Â  Â  local profileNames = GetProfileNames()
Â  Â Â 
Â  Â  local targetComboFrame = nil
Â  Â  for _, child in pairs(configContent:GetChildren()) do
Â  Â  Â  Â  if child:IsA("Frame") and child:FindFirstChildOfClass("TextLabel") then
Â  Â  Â  Â  Â  Â  local label = child:FindFirstChildOfClass("TextLabel")
Â  Â  Â  Â  Â  Â  if label and label.Text == "Select Config" then [cite: 107]
Â  Â  Â  Â  Â  Â  Â  Â  targetComboFrame = child
Â  Â  Â  Â  Â  Â  Â  Â  break
Â  Â  Â  Â  Â  Â  end
Â  Â  Â  Â  end
Â  Â  end
Â  Â Â 
Â  Â  if targetComboFrame then
Â  Â  Â  Â  local dropdown = targetComboFrame:FindFirstChildOfClass("TextButton")
Â  Â  Â  Â  if dropdown then
Â  Â  Â  Â  Â  Â  dropdown.Text = selectedConfigProfile
Â  Â  Â  Â  end
Â  Â  end
end

local createProfileBtn = CreateActionButton("Create New Config", "Táº¡o Config má»›i", function()
Â  Â  local profileName = profileNameInput.Text
Â  Â  if profileName and profileName ~= "" then
Â  Â  Â  Â  if CreateNewProfile(profileName) then [cite: 108]
Â  Â  Â  Â  Â  Â  -- Kháº¯c phá»¥c lá»—i hiá»ƒn thá»‹ ComboBox sau khi táº¡o má»›i
Â  Â  Â  Â  Â  Â  selectedConfigProfile = profileName [cite: 108]
Â  Â  Â  Â  Â  Â  SaveConfig() [cite: 108]
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  -- Cáº¬P NHáº¬T TEXT TRÃŠN NÃšT COMBOBOX
Â  Â  Â  Â  Â  Â  local targetComboFrame = profileCombo.ParentÂ 
Â  Â  Â  Â  Â  Â  if targetComboFrame then
Â  Â  Â  Â  Â  Â  Â  Â  local dropdown = targetComboFrame:FindFirstChildOfClass("TextButton")
Â  Â  Â  Â  Â  Â  Â  Â  if dropdown then
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dropdown.Text = selectedConfigProfileÂ  [cite: 109]
Â  Â  Â  Â  Â  Â  Â  Â  end
Â  Â  Â  Â  Â  Â  end
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  RefreshProfileComboBox()Â  [cite: 109]
Â  Â  Â  Â  Â  Â  ApplyLoadedConfig() [cite: 109]
Â  Â  Â  Â  Â  Â  mainStatus.Text = "âœ… ÄÃ£ táº¡o Config: " .. profileName [cite: 109]
Â  Â  Â  Â  Â  Â  profileNameInput.Text = ""Â  [cite: 109]
Â  Â  Â  Â  else
Â  Â  Â  Â  Â  Â  mainStatus.Text = "âŒ Config Ä‘Ã£ tá»“n táº¡i: " .. profileName [cite: 109]
Â  Â  Â  Â  end
Â  Â  else
Â  Â  Â  Â  mainStatus.Text = "âŒ Vui lÃ²ng nháº­p tÃªn Config!"
Â  Â  end
end)
createProfileBtn.Parent = configContent

-- Táº¡o profile combo vá»›i danh sÃ¡ch config hiá»‡n táº¡i
local function GetProfileNames() [cite: 110]
Â  Â  local names = {"default"} [cite: 110]
Â  Â  for name, _ in pairs(configProfiles) do
Â  Â  Â  Â  if name ~= "default" then
Â  Â  Â  Â  Â  Â  table.insert(names, name) [cite: 110]
Â  Â  Â  Â  end
Â  Â  end
Â  Â  return names [cite: 110]
end

local profileCombo = CreateComboBox("Select Config", "Chá»n Config Ä‘á»ƒ quáº£n lÃ½", GetProfileNames(), function(selected)
Â  Â  selectedConfigProfile = selected
Â  Â  if LoadConfig(selectedConfigProfile) then
Â  Â  Â  Â  ApplyLoadedConfig()
Â  Â  Â  Â  mainStatus.Text = "ðŸ“‚ ÄÃ£ táº£i Config: " .. selectedConfigProfile
Â  Â  end
end)
profileCombo.Parent = configContent

local loadProfileBtn = CreateActionButton("Load Config", "Táº£i cáº¥u hÃ¬nh tá»« Config", function()
Â  Â  if LoadConfig(selectedConfigProfile) then
Â  Â  Â  Â  ApplyLoadedConfig()
Â  Â  Â  Â  mainStatus.Text = "ðŸ“‚ ÄÃ£ táº£i Config: " .. selectedConfigProfile [cite: 111]
Â  Â  else
Â  Â  Â  Â  mainStatus.Text = "âŒ KhÃ´ng thá»ƒ táº£i Config: " .. selectedConfigProfile [cite: 111]
Â  Â  end
end)
loadProfileBtn.Parent = configContent

local saveProfileBtn = CreateActionButton("Save to Config", "LÆ°u cáº¥u hÃ¬nh vÃ o Config", function()
Â  Â  SaveConfig()
Â  Â  mainStatus.Text = "ðŸ’¾ ÄÃ£ lÆ°u vÃ o Config: " .. selectedConfigProfile
end)
saveProfileBtn.Parent = configContent

local deleteProfileBtn = CreateActionButton("Delete Config", "XÃ³a Config Ä‘Ã£ chá»n", function()
Â  Â  if DeleteConfig(selectedConfigProfile) then
Â  Â  Â  Â  mainStatus.Text = "ðŸ—‘ï¸ ÄÃ£ xÃ³a Config: " .. selectedConfigProfile
Â  Â  Â  Â  selectedConfigProfile = "default"
Â  Â  Â  Â  LoadConfig("default")
Â  Â  Â  Â  ApplyLoadedConfig()
Â  Â  Â  Â  RefreshProfileComboBox()
Â  Â  else
Â  Â  Â  Â  mainStatus.Text = "âŒ KhÃ´ng thá»ƒ xÃ³a Config: " .. selectedConfigProfile [cite: 112]
Â  Â  end
end)
deleteProfileBtn.Parent = configContent

local autoLoadBtn = CreateActionButton("Set as Auto Load", "Tá»± Ä‘á»™ng load Config nÃ y khi khá»Ÿi Ä‘á»™ng", function()
Â  Â  if SetAutoLoadProfile(selectedConfigProfile) then
Â  Â  Â  Â  mainStatus.Text = "ðŸ”§ ÄÃ£ Ä‘áº·t auto load: " .. selectedConfigProfile
Â  Â  else
Â  Â  Â  Â  mainStatus.Text = "âŒ KhÃ´ng thá»ƒ Ä‘áº·t auto load: " .. selectedConfigProfile
Â  Â  end
end)
autoLoadBtn.Parent = configContent

-- SETTINGS TAB
local settingsContent = tabFrames["âš™ï¸ SETTINGS"]
antiAfkToggleFrame = CreateToggleSwitch("Enable Anti-AFK", "Chá»‘ng kick khi AFK", true, function(enabled)
Â  Â  antiAFKEnabled = enabled
Â  Â  if enabled then EnableAntiAFK() else DisableAntiAFK() end
end)
antiAfkToggleFrame.Parent = settingsContent

stealthToggleFrame = CreateToggleSwitch("Enable Stealth Mode", "áº¨n hoáº¡t Ä‘á»™ng khá»i server", true, function(enabled) [cite: 113]
Â  Â  stealthMode = enabled [cite: 113]
Â  Â  stealthModeEnabled = enabled [cite: 113]
Â  Â  StealthIndicator.BackgroundColor3 = enabled and ColorTheme.Success or ColorTheme.Danger [cite: 113]
Â  Â  StealthLabel.Text = enabled and "STEALTH: ON" or "STEALTH: OFF" [cite: 113]
Â  Â  StealthLabel.TextColor3 = enabled and ColorTheme.Success or ColorTheme.Danger [cite: 113]
end)
stealthToggleFrame.Parent = settingsContent

-- NEW: HÃ m dá»«ng táº¥t cáº£ cÃ¡c loopÂ 
local function StopAllLoops()
Â  Â  for name, _ in pairs(activeLoops) do
Â  Â  Â  Â  StopLoop(name)
Â  Â  end
end

-- NEW: HÃ m Ã¡p dá»¥ng config Ä‘Ã£ load (FIXED UI REFERENCES)
local function ApplyLoadedConfig()
Â  Â  StopAllLoops()

Â  Â  -- Cáº­p nháº­t táº¥t cáº£ cÃ¡c nÃºt toggle
Â  Â  UpdateToggleButton(autoAttackToggleFrame, autoAttackEnabled)
Â  Â  UpdateToggleButton(autoFarmSelectedToggleFrame, selectedFarmEnabled) [cite: 116]
Â  Â  UpdateToggleButton(autoFarmRandomToggleFrame, farmRandomEnabled) [cite: 116]
Â  Â  UpdateToggleButton(autoDropsToggleFrame, autoCollectEnabled) [cite: 116]
Â  Â  UpdateToggleButton(stealthToggleFrame, stealthModeEnabled) [cite: 114]
Â  Â  UpdateToggleButton(antiAfkToggleFrame, antiAFKEnabled) [cite: 114]
Â  Â  UpdateToggleButton(autoHatchEggToggleFrame, autoHatchEggEnabled) [cite: 116]
Â  Â  UpdateToggleButton(autoRankUpToggleFrame, autoRankUpEnabled) -- Cáº­p nháº­t NEW Toggle 
Â  Â Â 
Â  Â  -- Cáº­p nháº­t tráº¡ng thÃ¡i dungeon/raid toggle (FIXED: Sá»¬ Dá»¤NG TÃŠN TÃŒM KIáº¾M ÄÃšNG)
    local dungeonFarmToggle = tabFrames["ðŸ° DUNGEON"]:FindFirstChild("Toggle_EnableAutoFarmDungeon") [cite: 114]
    if dungeonFarmToggle then UpdateToggleButton(dungeonFarmToggle, autoFarmDungeonEnabled) end
Â  Â Â 
Â  Â  local autoJoinDungeonToggle = tabFrames["ðŸ° DUNGEON"]:FindFirstChild("Toggle_Auto-joinDungeon") -- TÃªn Toggle Ä‘Ã£ Ä‘Æ°á»£c táº¡o
Â  Â  if autoJoinDungeonToggle then UpdateToggleButton(autoJoinDungeonToggle, autoJoinDungeonEnabled) end [cite: 114]
Â  Â Â 
Â  Â  local autoJoinRaidToggle = tabFrames["ðŸ° DUNGEON"]:FindFirstChild("Toggle_Auto-joinRaid") -- TÃªn Toggle Ä‘Ã£ Ä‘Æ°á»£c táº¡o
Â  Â  if autoJoinRaidToggle then UpdateToggleButton(autoJoinRaidToggle, autoJoinRaidEnabled) end [cite: 115]
Â  Â Â 
Â  Â  local raidFarmToggle = tabFrames["ðŸ° DUNGEON"]:FindFirstChild("Toggle_EnableAutoFarmRaid") [cite: 115]
Â  Â  if raidFarmToggle then UpdateToggleButton(raidFarmToggle, autoFarmRaidEnabled) endÂ 
Â  Â Â 
Â  Â  local autoExitDungeonToggle = tabFrames["ðŸ° DUNGEON"]:FindFirstChild("Toggle_EnableAutoExitDungeon") [cite: 115]
Â  Â  if autoExitDungeonToggle then UpdateToggleButton(autoExitDungeonToggle, autoExitDungeonEnabled) endÂ 
Â  Â Â 
Â  Â  local autoExitRaidToggle = tabFrames["ðŸ° DUNGEON"]:FindFirstChild("Toggle_EnableAutoExitRaid") [cite: 115]
Â  Â  if autoExitRaidToggle then UpdateToggleButton(autoExitRaidToggle, autoExitRaidEnabled) endÂ 
Â  Â Â 
Â  Â  UpdateToggleButton(autoStatToggleFrame, autoStatEnabled) [cite: 117]
Â  Â Â 
Â  Â  -- Cáº­p nháº­t giÃ¡ trá»‹ TextBox
Â  Â  local dInput = tabFrames["ðŸ° DUNGEON"]:FindFirstChild("DungeonExitInput") [cite: 115]
Â  Â  if dInput then dInput.Text = tostring(exitDungeonWaveNumber) end
Â  Â Â 
Â  Â  local rInput = tabFrames["ðŸ° DUNGEON"]:FindFirstChild("RaidExitInput") [cite: 115]
Â  Â  if rInput then rInput.Text = tostring(exitRaidWaveNumber) end
Â  Â Â 
Â  Â  -- Cáº­p nháº­t stealth indicator
Â  Â  StealthIndicator.BackgroundColor3 = stealthMode and ColorTheme.Success or ColorTheme.Danger
Â  Â  StealthLabel.Text = stealthMode and "STEALTH: ON" or "STEALTH: OFF"
Â  Â  StealthLabel.TextColor3 = stealthMode and ColorTheme.Success or ColorTheme.Danger
Â  Â Â 
Â  Â  -- KÃ­ch hoáº¡t cÃ¡c vÃ²ng láº·p náº¿u cáº§n
Â  Â  if autoAttackEnabled then StartLoop("AutoAttack", AutoAttackLogic, 0.3) end
Â  Â  if selectedFarmEnabled then StartLoop("FarmSelected", FarmSelectedLogic, 0.1) end [cite: 116]
Â  Â  if farmRandomEnabled then StartLoop("FarmRandom", FarmRandomLogic, 0.5) end [cite: 116]
Â  Â  if autoCollectEnabled then StartLoop("AutoCollect", AutoCollectLogic, 1.0) end [cite: 116]
Â  Â  if autoHatchEggEnabled then StartLoop("AutoHatchEgg", AutoHatchEggLogic, 0.5) end [cite: 116]
Â  Â  if autoRankUpEnabled then StartLoop("AutoRankUp", AutoRankUpLogic, 5.0) end -- KÃ­ch hoáº¡t NEW Loop 
Â  Â Â 
Â  Â  -- Xá»­ lÃ½ Auto Join Loop (5s)
Â  Â  if autoJoinDungeonEnabled then StartLoop("AutoJoinDungeon", AutoJoinDungeonLoop, 5) end [cite: 116]
Â  Â  if autoJoinRaidEnabled then StartLoop("AutoJoinRaid", AutoJoinRaidLoop, 5) end [cite: 116]

Â  Â  -- Xá»­ lÃ½ Auto Farm Dungeon/Raid khi load config
Â  Â  if autoFarmDungeonEnabled thenÂ 
Â  Â  Â  Â  JoinDungeon(selectedDungeonMode)Â 
Â  Â  end
Â  Â  if autoFarmRaidEnabled thenÂ 
Â  Â  Â  Â  JoinRaid()Â 
Â  Â  end
Â  Â Â 
Â  Â  if autoStatEnabled then StartLoop("AutoStat", AutoStatLogic, 1) end [cite: 117]
Â  Â  if antiAFKEnabled then EnableAntiAFK() else DisableAntiAFK() end [cite: 117]
Â  Â Â 
Â  Â  -- Refresh farm display náº¿u Ä‘ang á»Ÿ tab FARM
Â  Â  if tabFrames["ðŸŒ¾ FARM"].Visible then
Â  Â  Â  Â  refreshGroupsBtn.MouseButton1Click:Fire()
Â  Â  end
Â  Â Â 
Â  Â  -- Cáº­p nháº­t danh sÃ¡ch config (profile)
Â  Â  RefreshProfileComboBox()
end

-- DRAG FUNCTIONALITY
local dragging, dragInput, dragStart, startPos
SafeConnect(TitleBar.InputBegan, function(input)
Â  Â  if input.UserInputType == Enum.UserInputType.MouseButton1 then
Â  Â  Â  Â  dragging = true
Â  Â  Â  Â  dragStart = input.Position
Â  Â  Â  Â  startPos = MainContainer.Position
Â  Â  end
end)
SafeConnect(TitleBar.InputChanged, function(input)
Â  Â  if input.UserInputType == Enum.UserInputType.MouseMovement then
Â  Â  Â  Â  dragInput = input
Â  Â  end
end)
SafeConnect(TitleBar.InputEnded, function(input)
Â  Â  if input.UserInputType == Enum.UserInputType.MouseButton1 then [cite: 118]
Â  Â  Â  Â  dragging = false
Â  Â  end
end)
SafeConnect(UserInputService.InputChanged, function(input)
Â  Â  if input == dragInput and dragging then
Â  Â  Â  Â  local delta = input.Position - dragStart
Â  Â  Â  Â  MainContainer.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
Â  Â  end
end)

-- NEW: PhÃ­m táº¯t Insert Ä‘á»ƒ áº©n/hiá»‡n UI
SafeConnect(UserInputService.InputBegan, function(input, gameProcessedEvent)
Â  Â  if input.KeyCode == Enum.KeyCode.Insert and not gameProcessedEvent then
Â  Â  Â  Â  ToggleUI(not HimonoHub.Enabled)
Â  Â  end
end)

-- Auto-adjust canvas sizes
task.spawn(function()
Â  Â  while true do
Â  Â  Â  Â  for _, frame in pairs(tabFrames) do
Â  Â  Â  Â  Â  Â  local layout = frame:FindFirstChildOfClass("UIListLayout")
Â  Â  Â  Â  Â  Â  if layout then [cite: 119]
Â  Â  Â  Â  Â  Â  Â  Â  frame.CanvasSize = UDim2.new(0, 0, 0, layout.AbsoluteContentSize.Y + 20) [cite: 119]
Â  Â  Â  Â  Â  Â  end
Â  Â  Â  Â  end
Â  Â  Â  Â  if TabListLayout then
Â  Â  Â  Â  Â  Â  TabContainer.CanvasSize = UDim2.new(0, TabListLayout.AbsoluteContentSize.X + 20, 0, 0) [cite: 119]
Â  Â  Â  Â  end
Â  Â  Â  Â  task.wait(0.5)
Â  Â  end
end)

-- Initialize
LoadProfiles()
if autoLoadProfile ~= "" and configProfiles[autoLoadProfile] then
Â  Â  selectedConfigProfile = autoLoadProfile
Â  Â  LoadConfig(autoLoadProfile)
Â  Â  ApplyLoadedConfig()
Â  Â  print("âš¡ AUTO-LOADED CONFIG: " .. autoLoadProfile)
else
Â  Â  if not configProfiles["default"] then
Â  Â  Â  Â  CreateNewProfile("default")
Â  Â  Â  Â  SaveConfig()
Â  Â  end
Â  Â  LoadConfig("default")
Â  Â  ApplyLoadedConfig()
end

print("âš¡ HIMONO HUB v4.3 - DARK EDITION (FINAL FIX) LOADED!") [cite: 120]
