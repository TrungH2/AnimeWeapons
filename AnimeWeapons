-- Himono Hub v4.2 - SULFUR EDITION (COMPLETE FIXED VERSION)
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local HttpService = game:GetService("HttpService")
local LocalPlayer = Players.LocalPlayer

local stealthMode = true
local safeConnections = {}
local activeLoops = {}
local selectedEnemyNames = {}
local selectedGachaType = "Biju"
local selectedZone = "Zone 1"
local selectedStat = "Attack"
local autoOpenEggEnabled = false

-- Config file path
local configFile = "HimonoHubSulfurConfig.txt"

-- Safe remote fire
local function SafeFire(remote, ...)
    if stealthMode then RunService.Heartbeat:Wait() end
    remote:FireServer(...)
end

local function SafeWait()
    if not stealthMode then task.wait(); return end
    math.randomseed(tick())
    local delay = math.random(20, 50) / 100
    local start = tick()
    while tick() - start < delay do RunService.Heartbeat:Wait() end
end

local function SafeCall(func, ...)
    local success, result = pcall(func, ...)
    return success and result or nil
end

local function SafeConnect(signal, callback)
    local conn = signal:Connect(function(...)
        if stealthMode then SafeWait() end
        SafeCall(callback, ...)
    end)
    table.insert(safeConnections, conn)
    return conn
end

local function StartLoop(name, func, interval)
    if activeLoops[name] then activeLoops[name] = false; task.wait(0.1) end
    activeLoops[name] = true
    task.spawn(function()
        while activeLoops[name] do
            pcall(func)
            if interval then task.wait(interval) else RunService.Heartbeat:Wait() end
        end
    end)
end

local function StopLoop(name)
    if activeLoops[name] then activeLoops[name] = false end
end

local antiAFKConnection
local function EnableAntiAFK()
    if antiAFKConnection then antiAFKConnection:Disconnect() end
    antiAFKConnection = LocalPlayer.Idled:Connect(function()
        SafeCall(function()
            VirtualUser:CaptureController()
            VirtualUser:ClickButton2(Vector2.new())
        end)
    end)
end

local ignoreNPCNames = {
    "npc", "gacha", "roll", "merchant", "shop", "vendor", "trader", "egg",
    "crate", "box", "dealer"
}

local function IsNPC(model)
    local modelName = model.Name:lower()
    for _, npcName in ipairs(ignoreNPCNames) do
        if modelName:find(npcName) then
            return true
        end
    end
    return false
end

local function FindEnemiesInRange(range)
    local character = LocalPlayer.Character
    if not character or not character:FindFirstChild("HumanoidRootPart") then return {} end
    local enemies = {}
    local playerPos = character.HumanoidRootPart.Position
    for _, obj in pairs(workspace:GetDescendants()) do
        if obj:IsA("Model") and obj:FindFirstChild("Humanoid") and obj:FindFirstChild("Head") then
            local isPlayer = false
            for _, player in pairs(Players:GetPlayers()) do
                if player.Character == obj then isPlayer = true; break end
            end
            local isNPC = IsNPC(obj)
            if not isPlayer and not isNPC and obj.Humanoid.Health > 0 then
                local distance = (playerPos - obj.Head.Position).Magnitude
                if distance <= (range or 100) then
                    table.insert(enemies, {
                        Model = obj,
                        Name = obj.Name,
                        Position = obj.Head.Position,
                        Distance = distance,
                        Health = obj.Humanoid.Health,
                        MaxHealth = obj.Humanoid.MaxHealth
                    })
                end
            end
        end
    end
    table.sort(enemies, function(a, b) return a.Distance < b.Distance end)
    return enemies
end

-- Group enemies by name
local function GetEnemyGroups()
    local enemies = FindEnemiesInRange(200)
    local groups = {}
    
    for _, enemy in ipairs(enemies) do
        if not groups[enemy.Name] then
            groups[enemy.Name] = {
                name = enemy.Name,
                count = 0,
                nearestDistance = math.huge,
                models = {}
            }
        end
        
        groups[enemy.Name].count = groups[enemy.Name].count + 1
        if enemy.Distance < groups[enemy.Name].nearestDistance then
            groups[enemy.Name].nearestDistance = enemy.Distance
        end
        table.insert(groups[enemy.Name].models, enemy.Model)
    end
    
    return groups
end

local function AutoAttackLogic()
    local enemies = FindEnemiesInRange(50)
    if #enemies > 0 then
        local nearestEnemy = enemies[1]
        local character = LocalPlayer.Character
        if character and character:FindFirstChild("HumanoidRootPart") then
            character.HumanoidRootPart.CFrame = CFrame.new(nearestEnemy.Position + Vector3.new(0,2,0))
            local remote = ReplicatedStorage:FindFirstChild("RemoteEvent") or ReplicatedStorage:FindFirstChild("Remote")
            if remote then SafeFire(remote, "Attack", nearestEnemy.Model) end
        end
    end
end

-- Faster farm selected with anti-cheat protection
local function FarmSelectedLogic()
    if #selectedEnemyNames == 0 then return end
    local character = LocalPlayer.Character
    if not character or not character:FindFirstChild("HumanoidRootPart") then return end
    
    local enemyGroups = GetEnemyGroups()
    
    for _, enemyName in ipairs(selectedEnemyNames) do
        if not activeLoops["FarmSelected"] then break end
        
        local group = enemyGroups[enemyName]
        if group and group.count > 0 then
            -- Find nearest enemy in this group
            local nearestEnemy = nil
            local minDistance = math.huge
            
            for _, model in ipairs(group.models) do
                if model and model:FindFirstChild("Humanoid") and model.Humanoid.Health > 0 then
                    local distance = (character.HumanoidRootPart.Position - model.Head.Position).Magnitude
                    if distance < minDistance then
                        minDistance = distance
                        nearestEnemy = model
                    end
                end
            end
            
            if nearestEnemy then
                -- Fast teleport with small random offset to avoid anti-cheat
                local offset = Vector3.new(
                    math.random(-2, 2),
                    3,
                    math.random(-2, 2)
                )
                character.HumanoidRootPart.CFrame = CFrame.new(nearestEnemy.Head.Position + offset)
                
                local remote = ReplicatedStorage:FindFirstChild("RemoteEvent") or ReplicatedStorage:FindFirstChild("Remote")
                if remote then
                    -- Quick attack burst
                    for i = 1, 3 do
                        if activeLoops["FarmSelected"] and nearestEnemy and nearestEnemy:FindFirstChild("Humanoid") and nearestEnemy.Humanoid.Health > 0 then
                            SafeFire(remote, "Attack", nearestEnemy)
                            task.wait(0.1)
                        else
                            break
                        end
                    end
                end
            end
        end
    end
end

local function FarmRandomLogic()
    local enemies = FindEnemiesInRange(50)
    local validEnemies = {}
    for _, enemy in ipairs(enemies) do
        if not IsNPC(enemy.Model) then
            table.insert(validEnemies, enemy)
        end
    end
    if #validEnemies > 0 then
        local randomEnemy = validEnemies[math.random(1, #validEnemies)]
        local character = LocalPlayer.Character
        if character and character:FindFirstChild("HumanoidRootPart") then
            character.HumanoidRootPart.CFrame = CFrame.new(randomEnemy.Position + Vector3.new(0,2,0))
            local remote = ReplicatedStorage:FindFirstChild("RemoteEvent") or ReplicatedStorage:FindFirstChild("Remote")
            if remote then SafeFire(remote, "Attack", randomEnemy.Model) end
        end
    end
end

local function AutoCollectLogic()
    local character = LocalPlayer.Character
    if not character then return end
    for _, obj in pairs(workspace:GetDescendants()) do
        if obj:IsA("Part") and (obj.Name:lower():find("drop") or obj.Name:lower():find("coin") or obj.Name:lower():find("reward")) then
            local distance = (character.HumanoidRootPart.Position - obj.Position).Magnitude
            if distance < 20 then
                local remote = ReplicatedStorage:FindFirstChild("RemoteEvent") or ReplicatedStorage:FindFirstChild("Remote")
                if remote then SafeFire(remote, "Collect", obj) end
            end
        end
    end
end

local function StartGacha(gachaType)
    local remote = ReplicatedStorage:FindFirstChild("Reply") and ReplicatedStorage.Reply:FindFirstChild("Reliable")
    if remote then
        SafeFire(remote, "Crate Roll Start", {[1]=gachaType,[2]=true})
        task.wait(1)
        SafeFire(remote, "Crate Roll Stop")
    end
end

local function TeleportToZone(zoneName)
    local remote = ReplicatedStorage:FindFirstChild("Reply") and ReplicatedStorage.Reply:FindFirstChild("Reliable")
    if remote then
        SafeFire(remote, "Zone Teleport", {[1]=zoneName})
    end
end

local function DistributeStat(statName)
    local remote = ReplicatedStorage:FindFirstChild("Reply") and ReplicatedStorage.Reply:FindFirstChild("Reliable")
    if remote then
        SafeFire(remote, "Distribute Stat Point", {[1]=statName})
    end
end

local function AutoOpenEggLogic()
    local character = LocalPlayer.Character
    if not character then return end
    
    -- Only open egg if near one
    for _, obj in pairs(workspace:GetDescendants()) do
        if obj:IsA("Model") and (obj.Name:lower():find("egg") or obj.Name:lower():find("crate")) then
            local distance = (character.HumanoidRootPart.Position - obj:GetPivot().Position).Magnitude
            if distance < 15 then
                local remote = ReplicatedStorage:FindFirstChild("Reply") and ReplicatedStorage.Reply:FindFirstChild("Reliable")
                if remote then
                    SafeFire(remote, "Open Star", {[1]="Egg"})
                end
                break
            end
        end
    end
end

-- SAVE/LOAD CONFIG
local function SaveConfig()
    local data = {
        selectedEnemyNames = selectedEnemyNames,
        selectedGachaType = selectedGachaType,
        selectedZone = selectedZone,
        selectedStat = selectedStat,
        autoOpenEggEnabled = autoOpenEggEnabled,
        stealthMode = stealthMode
    }
    local encoded = HttpService:JSONEncode(data)
    writefile(configFile, encoded)
end

local function LoadConfig()
    if isfile(configFile) then
        local success, data = pcall(function()
            local encoded = readfile(configFile)
            return HttpService:JSONDecode(encoded)
        end)
        if success and data then
            selectedEnemyNames = data.selectedEnemyNames or {}
            selectedGachaType = data.selectedGachaType or "Biju"
            selectedZone = data.selectedZone or "Zone 1"
            selectedStat = data.selectedStat or "Attack"
            autoOpenEggEnabled = data.autoOpenEggEnabled or false
            stealthMode = data.stealthMode or true
        end
    end
end

local function DeleteConfig()
    if isfile(configFile) then
        delfile(configFile)
    end
end

-- GUI Creation with PURPLE theme
local HimonoHub = Instance.new("ScreenGui")
HimonoHub.Name = "HimonoHubSulfur"
HimonoHub.ResetOnSpawn = false
HimonoHub.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
HimonoHub.Parent = game.CoreGui

local MainContainer = Instance.new("Frame")
MainContainer.Size = UDim2.new(0, 600, 0, 500)
MainContainer.Position = UDim2.new(0.5, -300, 0.5, -250)
MainContainer.BackgroundColor3 = Color3.fromRGB(120, 0, 200)
MainContainer.BorderSizePixel = 0
MainContainer.Parent = HimonoHub

local ContainerCorner = Instance.new("UICorner")
ContainerCorner.CornerRadius = UDim.new(0, 12)
ContainerCorner.Parent = MainContainer

local TitleBar = Instance.new("Frame")
TitleBar.Size = UDim2.new(1, 0, 0, 45)
TitleBar.BackgroundColor3 = Color3.fromRGB(80, 0, 160)
TitleBar.Parent = MainContainer

local TitleCorner = Instance.new("UICorner")
TitleCorner.CornerRadius = UDim.new(0, 12)
TitleCorner.Parent = TitleBar

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, -100, 1, 0)
Title.BackgroundTransparency = 1
Title.Text = "ðŸŸ£ HIMONO HUB v4.2 - PURPLE EDITION"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 18
Title.Parent = TitleBar

local StealthIndicator = Instance.new("Frame")
StealthIndicator.Size = UDim2.new(0, 12, 0, 12)
StealthIndicator.Position = UDim2.new(1, -90, 0.5, -6)
StealthIndicator.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
StealthIndicator.Parent = TitleBar

local StealthCorner = Instance.new("UICorner")
StealthCorner.CornerRadius = UDim.new(1, 0)
StealthCorner.Parent = StealthIndicator

local StealthLabel = Instance.new("TextLabel")
StealthLabel.Size = UDim2.new(0, 80, 1, 0)
StealthLabel.Position = UDim2.new(1, -80, 0, 0)
StealthLabel.BackgroundTransparency = 1
StealthLabel.Text = "STEALTH: ON"
StealthLabel.TextColor3 = Color3.fromRGB(0, 255, 0)
StealthLabel.Font = Enum.Font.Gotham
StealthLabel.TextSize = 11
StealthLabel.Parent = TitleBar

local TabContainer = Instance.new("ScrollingFrame")
TabContainer.Size = UDim2.new(1, -20, 0, 40)
TabContainer.Position = UDim2.new(0, 10, 0, 55)
TabContainer.BackgroundTransparency = 1
TabContainer.ScrollBarThickness = 3
TabContainer.ScrollBarImageColor3 = Color3.fromRGB(160, 0, 255)
TabContainer.CanvasSize = UDim2.new(2, 0, 0, 0)
TabContainer.Parent = MainContainer

local TabListLayout = Instance.new("UIListLayout")
TabListLayout.FillDirection = Enum.FillDirection.Horizontal
TabListLayout.Padding = UDim.new(0, 8)
TabListLayout.Parent = TabContainer

local ContentContainer = Instance.new("Frame")
ContentContainer.Size = UDim2.new(1, -20, 1, -120)
ContentContainer.Position = UDim2.new(0, 10, 0, 105)
ContentContainer.BackgroundColor3 = Color3.fromRGB(200, 150, 255)
ContentContainer.Parent = MainContainer

local ContentCorner = Instance.new("UICorner")
ContentCorner.CornerRadius = UDim.new(0, 8)
ContentCorner.Parent = ContentContainer

local ContentScroll = Instance.new("ScrollingFrame")
ContentScroll.Size = UDim2.new(1, 0, 1, 0)
ContentScroll.BackgroundTransparency = 1
ContentScroll.ScrollBarThickness = 5
ContentScroll.ScrollBarImageColor3 = Color3.fromRGB(160, 0, 255)
ContentScroll.CanvasSize = UDim2.new(0, 0, 2, 0)
ContentScroll.Parent = ContentContainer

local ContentLayout = Instance.new("UIListLayout")
ContentLayout.Padding = UDim.new(0, 15)
ContentLayout.Parent = ContentScroll

local tabs = {
    "ðŸ  MAIN", "ðŸŒ¾ FARM", "ðŸŽ° GACHA", "âš¡ STATS", 
    "ðŸš€ TELEPORT", "ðŸ¥š OPEN EGG", "âš™ï¸ SETTINGS"
}
local tabFrames, tabButtons = {}, {}

for i, tabName in pairs(tabs) do
    local tabButton = Instance.new("TextButton")
    tabButton.Size = UDim2.new(0, 120, 1, 0)
    tabButton.BackgroundColor3 = i == 1 and Color3.fromRGB(200, 100, 255) or Color3.fromRGB(120, 0, 200)
    tabButton.Text = tabName
    tabButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    tabButton.Font = Enum.Font.GothamBold
    tabButton.TextSize = 12
    tabButton.Parent = TabContainer

    local tabButtonCorner = Instance.new("UICorner")
    tabButtonCorner.CornerRadius = UDim.new(0, 6)
    tabButtonCorner.Parent = tabButton

    local contentFrame = Instance.new("ScrollingFrame")
    contentFrame.Size = UDim2.new(1, 0, 1, 0)
    contentFrame.BackgroundTransparency = 1
    contentFrame.ScrollBarThickness = 5
    contentFrame.ScrollBarImageColor3 = Color3.fromRGB(160, 0, 255)
    contentFrame.CanvasSize = UDim2.new(0, 0, 2, 0)
    contentFrame.Visible = i == 1
    contentFrame.Parent = ContentScroll

    local contentFrameLayout = Instance.new("UIListLayout")
    contentFrameLayout.Padding = UDim.new(0, 10)
    contentFrameLayout.Parent = contentFrame

    tabFrames[tabName] = contentFrame
    tabButtons[tabName] = tabButton

    SafeConnect(tabButton.MouseButton1Click, function()
        for name, frame in pairs(tabFrames) do
            frame.Visible = (name == tabName)
        end
        for name, btn in pairs(tabButtons) do
            btn.BackgroundColor3 = (name == tabName) and Color3.fromRGB(200, 100, 255) or Color3.fromRGB(120, 0, 200)
        end
    end)
end

function CreateToggleSwitch(text, description, default, callback)
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1, 0, 0, 50)
    frame.BackgroundTransparency = 1

    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(0.7, 0, 0.5, 0)
    label.Position = UDim2.new(0, 10, 0, 5)
    label.BackgroundTransparency = 1
    label.Text = text
    label.TextColor3 = Color3.fromRGB(255, 255, 255)
    label.Font = Enum.Font.GothamBold
    label.TextSize = 14
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = frame

    local desc = Instance.new("TextLabel")
    desc.Size = UDim2.new(0.7, 0, 0.5, 0)
    desc.Position = UDim2.new(0, 10, 0.5, 0)
    desc.BackgroundTransparency = 1
    desc.Text = description
    desc.TextColor3 = Color3.fromRGB(200, 200, 255)
    desc.Font = Enum.Font.Gotham
    desc.TextSize = 11
    desc.TextXAlignment = Enum.TextXAlignment.Left
    desc.Parent = frame

    local toggle = Instance.new("TextButton")
    toggle.Size = UDim2.new(0, 40, 0, 24)
    toggle.Position = UDim2.new(1, -60, 0.5, -12)
    toggle.BackgroundColor3 = default and Color3.fromRGB(0, 200, 0) or Color3.fromRGB(200, 0, 0)
    toggle.Text = default and "ON" or "OFF"
    toggle.TextColor3 = Color3.fromRGB(255, 255, 255)
    toggle.Font = Enum.Font.GothamBold
    toggle.TextSize = 12
    toggle.Parent = frame

    local toggled = default
    toggle.MouseButton1Click:Connect(function()
        toggled = not toggled
        toggle.BackgroundColor3 = toggled and Color3.fromRGB(0, 200, 0) or Color3.fromRGB(200, 0, 0)
        toggle.Text = toggled and "ON" or "OFF"
        if callback then callback(toggled) end
    end)

    return frame
end

function CreateActionButton(text, description, callback)
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1, 0, 0, 50)
    frame.BackgroundTransparency = 1

    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(0.5, 0, 0, 32)
    btn.Position = UDim2.new(0, 10, 0, 9)
    btn.BackgroundColor3 = Color3.fromRGB(160, 0, 255)
    btn.Text = text
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 13
    btn.Parent = frame

    local btnCorner = Instance.new("UICorner")
    btnCorner.CornerRadius = UDim.new(0, 6)
    btnCorner.Parent = btn

    local desc = Instance.new("TextLabel")
    desc.Size = UDim2.new(0.5, 0, 0, 20)
    desc.Position = UDim2.new(0.5, 20, 0, 15)
    desc.BackgroundTransparency = 1
    desc.Text = description
    desc.TextColor3 = Color3.fromRGB(200, 200, 255)
    desc.Font = Enum.Font.Gotham
    desc.TextSize = 11
    desc.TextXAlignment = Enum.TextXAlignment.Left
    desc.Parent = frame

    btn.MouseButton1Click:Connect(function()
        if callback then callback() end
    end)

    return frame
end

function CreateComboBox(text, description, items, callback)
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(1, 0, 0, 60)
    frame.BackgroundTransparency = 1

    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(0.5, 0, 0.5, 0)
    label.Position = UDim2.new(0, 10, 0, 5)
    label.BackgroundTransparency = 1
    label.Text = text
    label.TextColor3 = Color3.fromRGB(255, 255, 255)
    label.Font = Enum.Font.GothamBold
    label.TextSize = 14
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = frame

    local desc = Instance.new("TextLabel")
    desc.Size = UDim2.new(0.5, 0, 0.5, 0)
    desc.Position = UDim2.new(0, 10, 0.5, 0)
    desc.BackgroundTransparency = 1
    desc.Text = description
    desc.TextColor3 = Color3.fromRGB(200, 200, 255)
    desc.Font = Enum.Font.Gotham
    desc.TextSize = 11
    desc.TextXAlignment = Enum.TextXAlignment.Left
    desc.Parent = frame

    local dropdown = Instance.new("TextButton")
    dropdown.Size = UDim2.new(0.4, 0, 0, 32)
    dropdown.Position = UDim2.new(0.55, 0, 0.25, 0)
    dropdown.BackgroundColor3 = Color3.fromRGB(160, 0, 255)
    dropdown.Text = items[1] or "Select"
    dropdown.TextColor3 = Color3.fromRGB(255, 255, 255)
    dropdown.Font = Enum.Font.GothamBold
    dropdown.TextSize = 13
    dropdown.Parent = frame

    local btnCorner = Instance.new("UICorner")
    btnCorner.CornerRadius = UDim.new(0, 6)
    btnCorner.Parent = dropdown

    local selected = items[1]
    dropdown.MouseButton1Click:Connect(function()
        local menu = Instance.new("Frame")
        menu.Size = UDim2.new(0.4, 0, 0, #items*28)
        menu.Position = UDim2.new(0.55, 0, 0.75, 0)
        menu.BackgroundColor3 = Color3.fromRGB(200, 150, 255)
        menu.Parent = frame
        local menuCorner = Instance.new("UICorner")
        menuCorner.CornerRadius = UDim.new(0, 6)
        menuCorner.Parent = menu
        for i, item in ipairs(items) do
            local itemBtn = Instance.new("TextButton")
            itemBtn.Size = UDim2.new(1, 0, 0, 28)
            itemBtn.Position = UDim2.new(0, 0, 0, (i-1)*28)
            itemBtn.BackgroundColor3 = Color3.fromRGB(160, 0, 255)
            itemBtn.Text = item
            itemBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
            itemBtn.Font = Enum.Font.Gotham
            itemBtn.TextSize = 12
            itemBtn.Parent = menu
            itemBtn.MouseButton1Click:Connect(function()
                dropdown.Text = item
                selected = item
                menu:Destroy()
                if callback then callback(item) end
            end)
        end
    end)

    return frame
end

-- MAIN TAB
local mainContent = tabFrames["ðŸ  MAIN"]
local mainStatus = Instance.new("TextLabel")
mainStatus.Size = UDim2.new(1, -20, 0, 30)
mainStatus.BackgroundTransparency = 1
mainStatus.Text = "ðŸŸ£ Himono Hub - Farm theo nhÃ³m enemy!"
mainStatus.TextColor3 = Color3.fromRGB(255, 255, 255)
mainStatus.Font = Enum.Font.Gotham
mainStatus.TextSize = 14
mainStatus.Parent = mainContent

local autoAttackToggle = CreateToggleSwitch("Enable Auto Attack", "Tá»± Ä‘á»™ng táº¥n cÃ´ng káº» Ä‘á»‹ch gáº§n nháº¥t", false, function(enabled)
    if enabled then StartLoop("AutoAttack", AutoAttackLogic, 0.3) else StopLoop("AutoAttack") end
end)
autoAttackToggle.Parent = mainContent

local autoFarmSelectedToggle = CreateToggleSwitch("Enable Auto Farm Selected Enemies", "Tá»± Ä‘á»™ng farm Táº¤T Cáº¢ enemy cÃ¹ng tÃªn (FAST)", false, function(enabled)
    if enabled then StartLoop("FarmSelected", FarmSelectedLogic, 0.3) else StopLoop("FarmSelected") end
end)
autoFarmSelectedToggle.Parent = mainContent

local autoFarmRandomToggle = CreateToggleSwitch("Enable Farm Random Enemies", "Tá»± Ä‘á»™ng farm ngáº«u nhiÃªn (KHÃ”NG target NPC)", false, function(enabled)
    if enabled then StartLoop("FarmRandom", FarmRandomLogic, 0.5) else StopLoop("FarmRandom") end
end)
autoFarmRandomToggle.Parent = mainContent

local autoDropsToggle = CreateToggleSwitch("Enable Auto Collect All Drops", "Tá»± Ä‘á»™ng nháº·t váº­t pháº©m quanh báº¡n", false, function(enabled)
    if enabled then StartLoop("AutoCollect", AutoCollectLogic, 1.0) else StopLoop("AutoCollect") end
end)
autoDropsToggle.Parent = mainContent

-- FARM TAB
local farmContent = tabFrames["ðŸŒ¾ FARM"]

-- Refresh enemy groups display
local refreshGroupsBtn = CreateActionButton("Refresh Enemy Groups", "QuÃ©t vÃ  hiá»ƒn thá»‹ enemy theo nhÃ³m", function()
    for _, child in pairs(farmContent:GetChildren()) do
        if child:IsA("Frame") and string.find(child.Name or "", "GroupFrame") then
            child:Destroy()
        end
    end

    local enemyGroups = GetEnemyGroups()
    
    for enemyName, group in pairs(enemyGroups) do
        local groupFrame = Instance.new("Frame")
        groupFrame.Name = "GroupFrame_" .. enemyName
        groupFrame.Size = UDim2.new(1, 0, 0, 60)
        groupFrame.BackgroundColor3 = Color3.fromRGB(180, 120, 255)
        groupFrame.Parent = farmContent

        local cornerRadius = Instance.new("UICorner")
        cornerRadius.CornerRadius = UDim.new(0, 6)
        cornerRadius.Parent = groupFrame

        local nameLabel = Instance.new("TextLabel")
        nameLabel.Size = UDim2.new(0.6, 0, 0.5, 0)
        nameLabel.Position = UDim2.new(0, 10, 0, 5)
        nameLabel.BackgroundTransparency = 1
        nameLabel.Text = "ðŸ‘¹ " .. enemyName
        nameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
        nameLabel.Font = Enum.Font.GothamBold
        nameLabel.TextSize = 14
        nameLabel.TextXAlignment = Enum.TextXAlignment.Left
        nameLabel.Parent = groupFrame

        local infoLabel = Instance.new("TextLabel")
        infoLabel.Size = UDim2.new(0.6, 0, 0.5, 0)
        infoLabel.Position = UDim2.new(0, 10, 0.5, 0)
        infoLabel.BackgroundTransparency = 1
        infoLabel.Text = "ðŸ“Š Sá»‘ lÆ°á»£ng: " .. group.count .. " | Khoáº£ng cÃ¡ch: " .. math.floor(group.nearestDistance) .. "m"
        infoLabel.TextColor3 = Color3.fromRGB(230, 230, 255)
        infoLabel.Font = Enum.Font.Gotham
        infoLabel.TextSize = 11
        infoLabel.TextXAlignment = Enum.TextXAlignment.Left
        infoLabel.Parent = groupFrame

        local selectBtn = Instance.new("TextButton")
        selectBtn.Size = UDim2.new(0.3, 0, 0.6, 0)
        selectBtn.Position = UDim2.new(0.65, 0, 0.2, 0)
        selectBtn.BackgroundColor3 = Color3.fromRGB(160, 0, 255)
        selectBtn.Text = "ðŸŽ¯ CHá»ŒN NHÃ“M"
        selectBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
        selectBtn.Font = Enum.Font.GothamBold
        selectBtn.TextSize = 11
        selectBtn.Parent = groupFrame

        local selectCorner = Instance.new("UICorner")
        selectCorner.CornerRadius = UDim.new(0, 4)
        selectCorner.Parent = selectBtn

        local isSelected = false
        for _, selectedName in ipairs(selectedEnemyNames) do
            if selectedName == enemyName then
                isSelected = true
                break
            end
        end

        if isSelected then
            selectBtn.BackgroundColor3 = Color3.fromRGB(0, 200, 0)
            selectBtn.Text = "âœ… ÄÃƒ CHá»ŒN"
        end

        selectBtn.MouseButton1Click:Connect(function()
            isSelected = not isSelected
            if isSelected then
                selectBtn.BackgroundColor3 = Color3.fromRGB(0, 200, 0)
                selectBtn.Text = "âœ… ÄÃƒ CHá»ŒN"
                local found = false
                for _, name in ipairs(selectedEnemyNames) do
                    if name == enemyName then found = true; break end
                end
                if not found then
                    table.insert(selectedEnemyNames, enemyName)
                end
            else
                selectBtn.BackgroundColor3 = Color3.fromRGB(160, 0, 255)
                selectBtn.Text = "ðŸŽ¯ CHá»ŒN NHÃ“M"
                for i, name in ipairs(selectedEnemyNames) do
                    if name == enemyName then
                        table.remove(selectedEnemyNames, i)
                        break
                    end
                end
            end
        end)
    end
end)
refreshGroupsBtn.Parent = farmContent

local clearFarmBtn = CreateActionButton("Clear Farm List", "XÃ³a danh sÃ¡ch enemy Ä‘Æ°á»£c chá»n", function()
    selectedEnemyNames = {}
    refreshGroupsBtn.MouseButton1Click:Fire()
end)
clearFarmBtn.Parent = farmContent

local showSelectedBtn = CreateActionButton("Show Selected Groups", "Hiá»ƒn thá»‹ cÃ¡c nhÃ³m Ä‘Ã£ chá»n", function()
    if #selectedEnemyNames == 0 then
        mainStatus.Text = "ðŸ“­ ChÆ°a chá»n nhÃ³m enemy nÃ o!"
    else
        mainStatus.Text = "ðŸ“‹ Äang farm " .. #selectedEnemyNames .. " nhÃ³m: " .. table.concat(selectedEnemyNames, ", ")
    end
end)
showSelectedBtn.Parent = farmContent

-- GACHA TAB
local gachaContent = tabFrames["ðŸŽ° GACHA"]
local gachaTypes = {"Biju", "Sayajin", "Race", "Haki", "Fruits"}
local gachaCombo = CreateComboBox("Gacha Type", "Chá»n loáº¡i gacha Ä‘á»ƒ roll", gachaTypes, function(selected)
    selectedGachaType = selected
end)
gachaCombo.Parent = gachaContent

for _, gacha in ipairs(gachaTypes) do
    local toggle = CreateToggleSwitch("Enable Auto Roll " .. gacha, "Tá»± Ä‘á»™ng roll " .. gacha, false, function(enabled)
        if enabled then
            StartLoop("AutoRoll"..gacha, function() StartGacha(gacha) end, 2)
        else
            StopLoop("AutoRoll"..gacha)
        end
    end)
    toggle.Parent = gachaContent
end

-- STATS TAB
local statsContent = tabFrames["âš¡ STATS"]
local statTypes = {"Attack", "Mastery", "Speed", "Luck"}
local statCombo = CreateComboBox("Stat Type", "Chá»n loáº¡i stat Ä‘á»ƒ cá»™ng", statTypes, function(selected)
    selectedStat = selected
end)
statCombo.Parent = statsContent

local distributeBtn = CreateActionButton("Distribute Stat Point", "Cá»™ng Ä‘iá»ƒm stat Ä‘Ã£ chá»n", function()
    DistributeStat(selectedStat)
end)
distributeBtn.Parent = statsContent

-- TELEPORT TAB
local teleportContent = tabFrames["ðŸš€ TELEPORT"]
local zoneList = {"Zone 1", "Zone 2", "Zone 3", "Zone 4"}
local zoneCombo = CreateComboBox("Zone", "Chá»n khu vá»±c Ä‘á»ƒ teleport", zoneList, function(selected)
    selectedZone = selected
end)
zoneCombo.Parent = teleportContent

local teleportBtn = CreateActionButton("Teleport", "Di chuyá»ƒn Ä‘áº¿n khu vá»±c Ä‘Ã£ chá»n", function()
    TeleportToZone(selectedZone)
end)
teleportBtn.Parent = teleportContent

-- OPEN EGG TAB
local eggContent = tabFrames["ðŸ¥š OPEN EGG"]
local openEggBtn = CreateActionButton("Open Egg", "Má»Ÿ egg gáº§n báº¡n", function()
    AutoOpenEggLogic()
end)
openEggBtn.Parent = eggContent

local autoOpenEggToggle = CreateToggleSwitch("Enable Auto Open Egg", "Tá»± Ä‘á»™ng má»Ÿ egg khi gáº§n (15m)", false, function(enabled)
    autoOpenEggEnabled = enabled
    if enabled then
        StartLoop("AutoOpenEgg", AutoOpenEggLogic, 2)
    else
        StopLoop("AutoOpenEgg")
    end
end)
autoOpenEggToggle.Parent = eggContent

-- SETTINGS TAB
local settingsContent = tabFrames["âš™ï¸ SETTINGS"]
local antiAfkToggle = CreateToggleSwitch("Enable Anti-AFK", "Chá»‘ng kick khi AFK", true, function(enabled)
    if enabled then EnableAntiAFK() end
end)
antiAfkToggle.Parent = settingsContent

local stealthToggle = CreateToggleSwitch("Enable Stealth Mode", "áº¨n hoáº¡t Ä‘á»™ng khá»i server", true, function(enabled)
    stealthMode = enabled
    StealthIndicator.BackgroundColor3 = enabled and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(255, 0, 0)
    StealthLabel.Text = enabled and "STEALTH: ON" or "STEALTH: OFF"
    StealthLabel.TextColor3 = enabled and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(255, 0, 0)
end)
stealthToggle.Parent = settingsContent

-- Config buttons in SETTINGS tab
local saveConfigBtn = CreateActionButton("Save Config", "LÆ°u láº¡i cáº¥u hÃ¬nh hiá»‡n táº¡i", function()
    SaveConfig()
    mainStatus.Text = "ðŸ’¾ ÄÃ£ lÆ°u cáº¥u hÃ¬nh!"
end)
saveConfigBtn.Parent = settingsContent

local loadConfigBtn = CreateActionButton("Load Config", "Táº£i láº¡i cáº¥u hÃ¬nh Ä‘Ã£ lÆ°u", function()
    LoadConfig()
    mainStatus.Text = "ðŸ“‚ ÄÃ£ táº£i cáº¥u hÃ¬nh!"
    if farmContent.Visible then
        refreshGroupsBtn.MouseButton1Click:Fire()
    end
end)
loadConfigBtn.Parent = settingsContent

local deleteConfigBtn = CreateActionButton("Delete Config", "XÃ³a file config Ä‘Ã£ lÆ°u", function()
    DeleteConfig()
    mainStatus.Text = "ðŸ—‘ï¸ ÄÃ£ xÃ³a cáº¥u hÃ¬nh!"
end)
deleteConfigBtn.Parent = settingsContent

-- DRAG FUNCTIONALITY
local dragging, dragInput, dragStart, startPos
SafeConnect(TitleBar.InputBegan, function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = input.Position
        startPos = MainContainer.Position
    end
end)
SafeConnect(TitleBar.InputChanged, function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement then
        dragInput = input
    end
end)
SafeConnect(TitleBar.InputEnded, function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = false
    end
end)
SafeConnect(UserInputService.InputChanged, function(input)
    if input == dragInput and dragging then
        local delta = input.Position - dragStart
        MainContainer.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
    end
end)

-- Auto-adjust canvas sizes
task.spawn(function()
    while true do
        for _, frame in pairs(tabFrames) do
            frame.CanvasSize = UDim2.new(0, 0, 0, frame.UIListLayout.AbsoluteContentSize.Y + 20)
        end
        TabContainer.CanvasSize = UDim2.new(0, TabListLayout.AbsoluteContentSize.X + 20, 0, 0)
        task.wait(0.5)
    end
end)

-- Initialize
EnableAntiAFK()
LoadConfig()

print("ðŸŸ£ Himono Hub v4.2 - PURPLE EDITION LOADED!")
